import{j as e}from"./query-vendor-C4XoQ8tj.js";import{u as k,r}from"./react-vendor-BpnWQj_L.js";import{u as D,s as d,N as w}from"./index-BvprY0-k.js";import"./i18n-vendor-BT3zpxCT.js";import"./supabase-vendor-NSJvwn9b.js";function $(){const f=k(),{profile:j}=D(),[a,v]=r.useState([]),[y,_]=r.useState(!0),[c,A]=r.useState("all"),[x,m]=r.useState(null),[S,h]=r.useState(!1),[l,u]=r.useState(""),[i,o]=r.useState(!1);r.useEffect(()=>{if(j?.role!=="admin"){f("/");return}g()},[j,f]);const g=async()=>{try{const{data:s,error:t}=await d.from("seller_applications").select(`
          *,
          profiles:user_id (
            full_name,
            email,
            student_id
          )
        `).order("created_at",{ascending:!1});if(t)throw t;v(s||[])}catch(s){console.error("Error fetching applications:",s)}finally{_(!1)}},R=async s=>{if(confirm(`Approve ${s.business_name}?`)){o(!0);try{const{error:t}=await d.from("seller_applications").update({status:"approved",updated_at:new Date().toISOString()}).eq("id",s.id);if(t)throw t;const{error:N}=await d.from("profiles").update({role:"seller"}).eq("id",s.user_id);if(N)throw N;const{error:p}=await d.from("seller_profiles").insert({user_id:s.user_id,business_name:s.business_name,business_category:s.business_category,business_description:s.business_description,contact_phone:s.contact_phone,contact_email:s.contact_email,subscription_status:"inactive",is_active:!0});if(p&&p.code!=="23505")throw p;alert("Application approved successfully!"),g()}catch(t){console.error("Error approving application:",t),alert("Failed to approve application: "+t.message)}finally{o(!1)}}},C=s=>{m(s),u(""),h(!0)},E=async()=>{if(!x||!l.trim()){alert("Please provide a rejection reason");return}o(!0);try{const{error:s}=await d.from("seller_applications").update({status:"rejected",rejection_reason:l,updated_at:new Date().toISOString()}).eq("id",x.id);if(s)throw s;alert("Application rejected"),h(!1),m(null),g()}catch(s){console.error("Error rejecting application:",s),alert("Failed to reject application: "+s.message)}finally{o(!1)}},b=a.filter(s=>c==="all"?!0:s.status===c),n={total:a.length,pending:a.filter(s=>s.status==="pending").length,approved:a.filter(s=>s.status==="approved").length,rejected:a.filter(s=>s.status==="rejected").length};return y?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-50",children:[e.jsx(w,{}),e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-teal-600 border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading applications..."})]})})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-50",children:[e.jsx(w,{}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-teal-500 to-teal-600 rounded-xl flex items-center justify-center",children:e.jsx("i",{className:"ri-file-list-3-line text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Seller Applications"}),e.jsx("p",{className:"text-gray-600",children:"Review and manage seller applications"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-100 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Applications"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:n.total})]}),e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center",children:e.jsx("i",{className:"ri-file-list-line text-2xl text-white"})})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-100 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Pending Review"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600",children:n.pending})]}),e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-xl flex items-center justify-center",children:e.jsx("i",{className:"ri-time-line text-2xl text-white"})})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-100 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Approved"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:n.approved})]}),e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center",children:e.jsx("i",{className:"ri-checkbox-circle-line text-2xl text-white"})})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-100 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Rejected"}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:n.rejected})]}),e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center",children:e.jsx("i",{className:"ri-close-circle-line text-2xl text-white"})})]})})]}),e.jsx("div",{className:"bg-white rounded-xl p-2 mb-6 border border-gray-100 shadow-sm inline-flex gap-2",children:["all","pending","approved","rejected"].map(s=>e.jsxs("button",{onClick:()=>A(s),className:`px-6 py-2 rounded-lg font-medium text-sm transition-all whitespace-nowrap cursor-pointer ${c===s?"bg-gradient-to-r from-teal-500 to-teal-600 text-white shadow-md":"text-gray-600 hover:bg-gray-50"}`,children:[s.charAt(0).toUpperCase()+s.slice(1),s!=="all"&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-white/20 rounded-full text-xs",children:n[s]})]},s))}),e.jsx("div",{className:"space-y-4",children:b.length===0?e.jsxs("div",{className:"bg-white rounded-xl p-12 text-center border border-gray-100",children:[e.jsx("i",{className:"ri-inbox-line text-6xl text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No applications found"})]}):b.map(s=>e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-100 shadow-sm hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-start lg:justify-between gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-teal-500 to-teal-600 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx("i",{className:"ri-store-3-line text-2xl text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:s.business_name}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${s.status==="approved"?"bg-green-100 text-green-700":s.status==="rejected"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"}`,children:s.status.toUpperCase()})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:[e.jsx("i",{className:"ri-user-line mr-1"}),s.profiles?.full_name," (",s.profiles?.student_id,")"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("i",{className:"ri-price-tag-3-line mr-1"}),s.business_category]})]})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:s.business_description})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("i",{className:"ri-phone-line text-teal-600"}),e.jsx("span",{children:s.contact_phone})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("i",{className:"ri-mail-line text-teal-600"}),e.jsx("span",{children:s.contact_email})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("span",{children:[e.jsx("i",{className:"ri-calendar-line mr-1"}),"Applied: ",new Date(s.created_at).toLocaleDateString()]}),s.updated_at!==s.created_at&&e.jsxs("span",{children:[e.jsx("i",{className:"ri-refresh-line mr-1"}),"Updated: ",new Date(s.updated_at).toLocaleDateString()]})]}),s.rejection_reason&&e.jsxs("div",{className:"mt-4 bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-red-900 mb-1",children:"Rejection Reason:"}),e.jsx("p",{className:"text-sm text-red-800",children:s.rejection_reason})]})]}),s.status==="pending"&&e.jsxs("div",{className:"flex flex-col gap-3 lg:w-48",children:[e.jsxs("button",{onClick:()=>R(s),disabled:i,className:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg hover:from-green-600 hover:to-green-700 transition-all font-medium text-sm whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer flex items-center justify-center gap-2",children:[e.jsx("i",{className:"ri-checkbox-circle-line text-lg"}),"Approve"]}),e.jsxs("button",{onClick:()=>C(s),disabled:i,className:"w-full px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all font-medium text-sm whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer flex items-center justify-center gap-2",children:[e.jsx("i",{className:"ri-close-circle-line text-lg"}),"Reject"]})]})]})},s.id))})]}),S&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center",children:e.jsx("i",{className:"ri-close-circle-line text-2xl text-white"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Reject Application"})]}),e.jsxs("p",{className:"text-gray-600 mb-4",children:["Please provide a reason for rejecting ",e.jsx("strong",{children:x?.business_name})]}),e.jsx("textarea",{value:l,onChange:s=>u(s.target.value),placeholder:"Enter rejection reason...",rows:4,maxLength:500,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent resize-none mb-2"}),e.jsxs("p",{className:"text-xs text-gray-500 mb-4",children:[l.length,"/500 characters"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{h(!1),m(null)},disabled:i,className:"flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all font-medium text-sm whitespace-nowrap disabled:opacity-50 cursor-pointer",children:"Cancel"}),e.jsx("button",{onClick:E,disabled:i||!l.trim(),className:"flex-1 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all font-medium text-sm whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer",children:i?"Rejecting...":"Confirm Rejection"})]})]})})]})}export{$ as default};
//# sourceMappingURL=SellerApplications-BSbyU1At.js.map
