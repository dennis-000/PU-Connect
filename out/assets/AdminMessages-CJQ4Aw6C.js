import{j as e}from"./query-vendor-C4XoQ8tj.js";import{u as j,r as a}from"./react-vendor-BpnWQj_L.js";import{u as N,s as h,N as v}from"./index-BvprY0-k.js";import"./i18n-vendor-BT3zpxCT.js";import"./supabase-vendor-NSJvwn9b.js";function M(){const{profile:c}=N(),n=j(),[i,f]=a.useState([]),[r,o]=a.useState(null),[d,u]=a.useState([]),[p,x]=a.useState(!0),[m,l]=a.useState(null);a.useEffect(()=>{if(c?.role!=="admin"){n("/marketplace");return}b()},[c,n]),a.useEffect(()=>{r&&y(r.id)},[r]);const b=async()=>{x(!0),l(null);try{const{data:s,error:t}=await h.from("conversations").select(`
          *,
          buyer:profiles!buyer_id(full_name, email),
          seller:profiles!seller_id(full_name, email),
          product:products(name)
        `).order("last_message_at",{ascending:!1});t?(console.error("Error fetching conversations:",t),l("Failed to fetch conversations")):s&&(f(s),s.length>0&&o(s[0]))}catch(s){console.error("Unexpected error:",s),l("An unexpected error occurred")}finally{x(!1)}},y=async s=>{try{const{data:t,error:g}=await h.from("messages").select(`
          *,
          sender:profiles!sender_id(full_name)
        `).eq("conversation_id",s).order("created_at",{ascending:!0});g?console.error("Error fetching messages:",g):t&&u(t)}catch(t){console.error("Unexpected error fetching messages:",t)}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(v,{}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Message Monitoring"}),e.jsx("p",{className:"text-gray-600",children:"Monitor all conversations between buyers and sellers"})]}),m&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-600 text-sm",children:m})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",style:{height:"calc(100vh - 250px)"},children:e.jsxs("div",{className:"grid grid-cols-12 h-full",children:[e.jsx("div",{className:"col-span-4 border-r border-gray-200 overflow-y-auto",children:p?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"w-8 h-8 border-4 border-gray-200 border-t-gray-900 rounded-full animate-spin"})}):i.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-6 text-center",children:[e.jsx("i",{className:"ri-message-3-line text-5xl text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No conversations"}),e.jsx("p",{className:"text-sm text-gray-600",children:"No messages have been sent yet"})]}):e.jsx("div",{children:i.map(s=>e.jsx("div",{onClick:()=>o(s),className:`p-4 border-b border-gray-200 hover:bg-gray-50 cursor-pointer transition-colors ${r?.id===s.id?"bg-gray-50":""}`,children:e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900",children:[s.buyer?.full_name," ↔ ",s.seller?.full_name]}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.last_message_at).toLocaleDateString()})]}),s.product&&e.jsxs("p",{className:"text-xs text-gray-500 mb-1",children:["Re: ",s.product.name]}),e.jsx("p",{className:"text-sm text-gray-600 truncate",children:s.last_message||"No messages yet"})]})},s.id))})}),e.jsx("div",{className:"col-span-8 flex flex-col",children:r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:[e.jsxs("h3",{className:"text-base font-semibold text-gray-900 mb-1",children:[r.buyer?.full_name," ↔ ",r.seller?.full_name]}),r.product&&e.jsxs("p",{className:"text-xs text-gray-600",children:["About: ",r.product.name]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:d.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-gray-500",children:"No messages in this conversation"})}):d.map(s=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-900",children:s.sender?.full_name}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.created_at).toLocaleString()})]}),e.jsx("div",{className:"bg-gray-100 rounded-lg px-4 py-2 max-w-md",children:e.jsx("p",{className:"text-sm text-gray-900",children:s.message})})]},s.id))})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-chat-3-line text-5xl text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Select a conversation"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Choose a conversation to view messages"})]})})})]})})]})]})}export{M as default};
//# sourceMappingURL=AdminMessages-CJQ4Aw6C.js.map
