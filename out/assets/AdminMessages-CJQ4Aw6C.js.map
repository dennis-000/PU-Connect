{"version":3,"file":"AdminMessages-CJQ4Aw6C.js","sources":["../../src/pages/admin/AdminMessages.tsx"],"sourcesContent":["\nimport { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useAuth } from '../../contexts/AuthContext';\nimport { supabase } from '../../lib/supabase';\nimport Navbar from '../../components/feature/Navbar';\n\ninterface Conversation {\n  id: string;\n  buyer_id: string;\n  seller_id: string;\n  product_id: string | null;\n  last_message: string | null;\n  last_message_at: string;\n  buyer?: { full_name: string; email: string };\n  seller?: { full_name: string; email: string };\n  product?: { name: string };\n}\n\ninterface Message {\n  id: string;\n  sender_id: string;\n  receiver_id: string;\n  message: string;\n  created_at: string;\n  sender?: { full_name: string };\n}\n\nexport default function AdminMessages() {\n  const { profile } = useAuth();\n  const navigate = useNavigate();\n  const [conversations, setConversations] = useState<Conversation[]>([]);\n  const [selectedConversation, setSelectedConversation] = useState<Conversation | null>(null);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (profile?.role !== 'admin') {\n      navigate('/marketplace');\n      return;\n    }\n    fetchConversations();\n  }, [profile, navigate]);\n\n  useEffect(() => {\n    if (selectedConversation) {\n      fetchMessages(selectedConversation.id);\n    }\n  }, [selectedConversation]);\n\n  const fetchConversations = async () => {\n    setLoading(true);\n    setError(null);\n    try {\n      const { data, error } = await supabase\n        .from('conversations')\n        .select(`\n          *,\n          buyer:profiles!buyer_id(full_name, email),\n          seller:profiles!seller_id(full_name, email),\n          product:products(name)\n        `)\n        .order('last_message_at', { ascending: false });\n\n      if (error) {\n        console.error('Error fetching conversations:', error);\n        setError('Failed to fetch conversations');\n      } else if (data) {\n        setConversations(data as any);\n        if (data.length > 0) {\n          setSelectedConversation(data[0] as any);\n        }\n      }\n    } catch (err) {\n      console.error('Unexpected error:', err);\n      setError('An unexpected error occurred');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchMessages = async (conversationId: string) => {\n    try {\n      const { data, error } = await supabase\n        .from('messages')\n        .select(`\n          *,\n          sender:profiles!sender_id(full_name)\n        `)\n        .eq('conversation_id', conversationId)\n        .order('created_at', { ascending: true });\n\n      if (error) {\n        console.error('Error fetching messages:', error);\n      } else if (data) {\n        setMessages(data as any);\n      }\n    } catch (err) {\n      console.error('Unexpected error fetching messages:', err);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <Navbar />\n\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"mb-6\">\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">Message Monitoring</h1>\n          <p className=\"text-gray-600\">Monitor all conversations between buyers and sellers</p>\n        </div>\n\n        {error && (\n          <div className=\"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg\">\n            <p className=\"text-red-600 text-sm\">{error}</p>\n          </div>\n        )}\n\n        <div className=\"bg-white rounded-xl border border-gray-200 overflow-hidden\" style={{ height: 'calc(100vh - 250px)' }}>\n          <div className=\"grid grid-cols-12 h-full\">\n            {/* Conversations List */}\n            <div className=\"col-span-4 border-r border-gray-200 overflow-y-auto\">\n              {loading ? (\n                <div className=\"flex items-center justify-center h-full\">\n                  <div className=\"w-8 h-8 border-4 border-gray-200 border-t-gray-900 rounded-full animate-spin\"></div>\n                </div>\n              ) : conversations.length === 0 ? (\n                <div className=\"flex flex-col items-center justify-center h-full p-6 text-center\">\n                  <i className=\"ri-message-3-line text-5xl text-gray-300 mb-4\"></i>\n                  <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">No conversations</h3>\n                  <p className=\"text-sm text-gray-600\">No messages have been sent yet</p>\n                </div>\n              ) : (\n                <div>\n                  {conversations.map((conversation) => (\n                    <div\n                      key={conversation.id}\n                      onClick={() => setSelectedConversation(conversation)}\n                      className={`p-4 border-b border-gray-200 hover:bg-gray-50 cursor-pointer transition-colors ${\n                        selectedConversation?.id === conversation.id ? 'bg-gray-50' : ''\n                      }`}\n                    >\n                      <div className=\"mb-2\">\n                        <div className=\"flex items-center justify-between mb-1\">\n                          <h3 className=\"text-sm font-semibold text-gray-900\">\n                            {conversation.buyer?.full_name} ↔ {conversation.seller?.full_name}\n                          </h3>\n                          <span className=\"text-xs text-gray-500\">\n                            {new Date(conversation.last_message_at).toLocaleDateString()}\n                          </span>\n                        </div>\n                        {conversation.product && (\n                          <p className=\"text-xs text-gray-500 mb-1\">\n                            Re: {conversation.product.name}\n                          </p>\n                        )}\n                        <p className=\"text-sm text-gray-600 truncate\">\n                          {conversation.last_message || 'No messages yet'}\n                        </p>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n\n            {/* Messages Area */}\n            <div className=\"col-span-8 flex flex-col\">\n              {selectedConversation ? (\n                <>\n                  {/* Chat Header */}\n                  <div className=\"p-4 border-b border-gray-200 bg-gray-50\">\n                    <h3 className=\"text-base font-semibold text-gray-900 mb-1\">\n                      {selectedConversation.buyer?.full_name} ↔ {selectedConversation.seller?.full_name}\n                    </h3>\n                    {selectedConversation.product && (\n                      <p className=\"text-xs text-gray-600\">\n                        About: {selectedConversation.product.name}\n                      </p>\n                    )}\n                  </div>\n\n                  {/* Messages */}\n                  <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n                    {messages.length === 0 ? (\n                      <div className=\"flex items-center justify-center h-full\">\n                        <p className=\"text-gray-500\">No messages in this conversation</p>\n                      </div>\n                    ) : (\n                      messages.map((message) => (\n                        <div key={message.id} className=\"flex flex-col\">\n                          <div className=\"flex items-center space-x-2 mb-1\">\n                            <span className=\"text-xs font-semibold text-gray-900\">\n                              {message.sender?.full_name}\n                            </span>\n                            <span className=\"text-xs text-gray-500\">\n                              {new Date(message.created_at).toLocaleString()}\n                            </span>\n                          </div>\n                          <div className=\"bg-gray-100 rounded-lg px-4 py-2 max-w-md\">\n                            <p className=\"text-sm text-gray-900\">{message.message}</p>\n                          </div>\n                        </div>\n                      ))\n                    )}\n                  </div>\n                </>\n              ) : (\n                <div className=\"flex items-center justify-center h-full\">\n                  <div className=\"text-center\">\n                    <i className=\"ri-chat-3-line text-5xl text-gray-300 mb-4\"></i>\n                    <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">Select a conversation</h3>\n                    <p className=\"text-sm text-gray-600\">Choose a conversation to view messages</p>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":["AdminMessages","profile","useAuth","navigate","useNavigate","conversations","setConversations","useState","selectedConversation","setSelectedConversation","messages","setMessages","loading","setLoading","error","setError","useEffect","fetchConversations","fetchMessages","data","supabase","err","conversationId","jsxs","jsx","Navbar","conversation","Fragment","message"],"mappings":"mOA4BA,SAAwBA,GAAgB,CACtC,KAAM,CAAE,QAAAC,CAAA,EAAYC,EAAA,EACdC,EAAWC,EAAA,EACX,CAACC,EAAeC,CAAgB,EAAIC,EAAAA,SAAyB,CAAA,CAAE,EAC/D,CAACC,EAAsBC,CAAuB,EAAIF,EAAAA,SAA8B,IAAI,EACpF,CAACG,EAAUC,CAAW,EAAIJ,EAAAA,SAAoB,CAAA,CAAE,EAChD,CAACK,EAASC,CAAU,EAAIN,EAAAA,SAAS,EAAI,EACrC,CAACO,EAAOC,CAAQ,EAAIR,EAAAA,SAAwB,IAAI,EAEtDS,EAAAA,UAAU,IAAM,CACd,GAAIf,GAAS,OAAS,QAAS,CAC7BE,EAAS,cAAc,EACvB,MACF,CACAc,EAAA,CACF,EAAG,CAAChB,EAASE,CAAQ,CAAC,EAEtBa,EAAAA,UAAU,IAAM,CACVR,GACFU,EAAcV,EAAqB,EAAE,CAEzC,EAAG,CAACA,CAAoB,CAAC,EAEzB,MAAMS,EAAqB,SAAY,CACrCJ,EAAW,EAAI,EACfE,EAAS,IAAI,EACb,GAAI,CACF,KAAM,CAAE,KAAAI,EAAM,MAAAL,CAAAA,EAAU,MAAMM,EAC3B,KAAK,eAAe,EACpB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA,SAKP,EACA,MAAM,kBAAmB,CAAE,UAAW,GAAO,EAE5CN,GACF,QAAQ,MAAM,gCAAiCA,CAAK,EACpDC,EAAS,+BAA+B,GAC/BI,IACTb,EAAiBa,CAAW,EACxBA,EAAK,OAAS,GAChBV,EAAwBU,EAAK,CAAC,CAAQ,EAG5C,OAASE,EAAK,CACZ,QAAQ,MAAM,oBAAqBA,CAAG,EACtCN,EAAS,8BAA8B,CACzC,QAAA,CACEF,EAAW,EAAK,CAClB,CACF,EAEMK,EAAgB,MAAOI,GAA2B,CACtD,GAAI,CACF,KAAM,CAAE,KAAAH,EAAM,MAAAL,CAAAA,EAAU,MAAMM,EAC3B,KAAK,UAAU,EACf,OAAO;AAAA;AAAA;AAAA,SAGP,EACA,GAAG,kBAAmBE,CAAc,EACpC,MAAM,aAAc,CAAE,UAAW,GAAM,EAEtCR,EACF,QAAQ,MAAM,2BAA4BA,CAAK,EACtCK,GACTR,EAAYQ,CAAW,CAE3B,OAASE,EAAK,CACZ,QAAQ,MAAM,sCAAuCA,CAAG,CAC1D,CACF,EAEA,OACEE,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAC,EAAAA,IAACC,EAAA,EAAO,EAERF,EAAAA,KAAC,MAAA,CAAI,UAAU,8CACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,CAAAC,EAAAA,IAAC,KAAA,CAAG,UAAU,wCAAwC,SAAA,qBAAkB,EACxEA,EAAAA,IAAC,IAAA,CAAE,UAAU,gBAAgB,SAAA,sDAAA,CAAoD,CAAA,EACnF,EAECV,GACCU,EAAAA,IAAC,MAAA,CAAI,UAAU,sDACb,eAAC,IAAA,CAAE,UAAU,uBAAwB,SAAAV,CAAA,CAAM,CAAA,CAC7C,EAGFU,EAAAA,IAAC,MAAA,CAAI,UAAU,6DAA6D,MAAO,CAAE,OAAQ,qBAAA,EAC3F,SAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,2BAEb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,sDACZ,SAAAZ,QACE,MAAA,CAAI,UAAU,0CACb,SAAAY,EAAAA,IAAC,MAAA,CAAI,UAAU,8EAAA,CAA+E,CAAA,CAChG,EACEnB,EAAc,SAAW,EAC3BkB,EAAAA,KAAC,MAAA,CAAI,UAAU,mEACb,SAAA,CAAAC,EAAAA,IAAC,IAAA,CAAE,UAAU,+CAAA,CAAgD,EAC7DA,EAAAA,IAAC,KAAA,CAAG,UAAU,2CAA2C,SAAA,mBAAgB,EACzEA,EAAAA,IAAC,IAAA,CAAE,UAAU,wBAAwB,SAAA,gCAAA,CAA8B,CAAA,EACrE,EAEAA,EAAAA,IAAC,MAAA,CACE,SAAAnB,EAAc,IAAKqB,GAClBF,EAAAA,IAAC,MAAA,CAEC,QAAS,IAAMf,EAAwBiB,CAAY,EACnD,UAAW,kFACTlB,GAAsB,KAAOkB,EAAa,GAAK,aAAe,EAChE,GAEA,SAAAH,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,CAAAA,EAAAA,KAAC,KAAA,CAAG,UAAU,sCACX,SAAA,CAAAG,EAAa,OAAO,UAAU,MAAIA,EAAa,QAAQ,SAAA,EAC1D,EACAF,EAAAA,IAAC,OAAA,CAAK,UAAU,wBACb,SAAA,IAAI,KAAKE,EAAa,eAAe,EAAE,mBAAA,CAAmB,CAC7D,CAAA,EACF,EACCA,EAAa,SACZH,OAAC,IAAA,CAAE,UAAU,6BAA6B,SAAA,CAAA,OACnCG,EAAa,QAAQ,IAAA,EAC5B,QAED,IAAA,CAAE,UAAU,iCACV,SAAAA,EAAa,cAAgB,iBAAA,CAChC,CAAA,CAAA,CACF,CAAA,EAvBKA,EAAa,EAAA,CAyBrB,EACH,CAAA,CAEJ,EAGAF,MAAC,MAAA,CAAI,UAAU,2BACZ,WACCD,EAAAA,KAAAI,WAAA,CAEE,SAAA,CAAAJ,EAAAA,KAAC,MAAA,CAAI,UAAU,0CACb,SAAA,CAAAA,EAAAA,KAAC,KAAA,CAAG,UAAU,6CACX,SAAA,CAAAf,EAAqB,OAAO,UAAU,MAAIA,EAAqB,QAAQ,SAAA,EAC1E,EACCA,EAAqB,SACpBe,OAAC,IAAA,CAAE,UAAU,wBAAwB,SAAA,CAAA,UAC3Bf,EAAqB,QAAQ,IAAA,CAAA,CACvC,CAAA,EAEJ,EAGAgB,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACZ,SAAAd,EAAS,SAAW,EACnBc,EAAAA,IAAC,MAAA,CAAI,UAAU,0CACb,SAAAA,MAAC,KAAE,UAAU,gBAAgB,SAAA,kCAAA,CAAgC,CAAA,CAC/D,EAEAd,EAAS,IAAKkB,GACZL,EAAAA,KAAC,MAAA,CAAqB,UAAU,gBAC9B,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,mCACb,SAAA,CAAAC,MAAC,OAAA,CAAK,UAAU,sCACb,SAAAI,EAAQ,QAAQ,UACnB,EACAJ,EAAAA,IAAC,OAAA,CAAK,UAAU,wBACb,SAAA,IAAI,KAAKI,EAAQ,UAAU,EAAE,eAAA,CAAe,CAC/C,CAAA,EACF,EACAJ,EAAAA,IAAC,MAAA,CAAI,UAAU,4CACb,SAAAA,EAAAA,IAAC,KAAE,UAAU,wBAAyB,SAAAI,EAAQ,OAAA,CAAQ,CAAA,CACxD,CAAA,GAXQA,EAAQ,EAYlB,CACD,CAAA,CAEL,CAAA,CAAA,CACF,QAEC,MAAA,CAAI,UAAU,0CACb,SAAAL,EAAAA,KAAC,MAAA,CAAI,UAAU,cACb,SAAA,CAAAC,EAAAA,IAAC,IAAA,CAAE,UAAU,4CAAA,CAA6C,EAC1DA,EAAAA,IAAC,KAAA,CAAG,UAAU,2CAA2C,SAAA,wBAAqB,EAC9EA,EAAAA,IAAC,IAAA,CAAE,UAAU,wBAAwB,SAAA,wCAAA,CAAsC,CAAA,CAAA,CAC7E,EACF,CAAA,CAEJ,CAAA,CAAA,CACF,CAAA,CACF,CAAA,CAAA,CACF,CAAA,EACF,CAEJ"}