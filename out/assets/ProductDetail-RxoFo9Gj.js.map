{"version":3,"file":"ProductDetail-RxoFo9Gj.js","sources":["../../src/pages/product/ProductDetail.tsx"],"sourcesContent":["\nimport { useState, useEffect } from 'react';\nimport { useParams, useNavigate, Link } from 'react-router-dom';\nimport { supabase, type Product, type Profile } from '../../lib/supabase';\nimport { useAuth } from '../../contexts/AuthContext';\nimport Navbar from '../../components/feature/Navbar';\nimport { getOptimizedImageUrl } from '../../lib/imageOptimization';\n\nexport default function ProductDetail() {\n  const { id } = useParams();\n  const { user } = useAuth();\n  const navigate = useNavigate();\n  const [product, setProduct] = useState<(Product & { seller: Profile }) | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    if (id) {\n      fetchProduct();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [id]);\n\n  const fetchProduct = async () => {\n    setLoading(true);\n    const { data, error } = await supabase\n      .from('products')\n      .select('*, seller:profiles!seller_id(*)')\n      .eq('id', id)\n      .single();\n\n    if (!error && data) {\n      setProduct(data as any);\n    }\n    setLoading(false);\n  };\n\n  const handleWhatsAppContact = () => {\n    if (!product?.whatsapp_number) {\n      alert('WhatsApp number not available');\n      return;\n    }\n    \n    const message = encodeURIComponent(\n      `Hi! I'm interested in your product: ${product.name}`\n    );\n    const whatsappUrl = `https://wa.me/${product.whatsapp_number.replace(/[^0-9]/g, '')}?text=${message}`;\n    window.open(whatsappUrl, '_blank');\n  };\n\n  const handleInAppMessage = async () => {\n    if (!user) {\n      navigate('/login');\n      return;\n    }\n\n    if (!product) return;\n\n    const { data: existingConversation } = await supabase\n      .from('conversations')\n      .select('id')\n      .eq('buyer_id', user.id)\n      .eq('seller_id', product.seller_id)\n      .eq('product_id', product.id)\n      .single();\n\n    if (existingConversation) {\n      navigate('/messages');\n      return;\n    }\n\n    const { error } = await supabase\n      .from('conversations')\n      .insert({\n        buyer_id: user.id,\n        seller_id: product.seller_id,\n        product_id: product.id,\n        last_message: 'Conversation started',\n        last_message_at: new Date().toISOString(),\n      });\n\n    if (!error) {\n      navigate('/messages');\n    } else {\n      console.error('Error creating conversation:', error);\n      alert('Failed to start conversation. Please try again.');\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <Navbar />\n        <div className=\"text-center py-20\">\n          <div className=\"inline-block w-10 h-10 border-4 border-gray-200 border-t-blue-600 rounded-full animate-spin\"></div>\n          <p className=\"mt-4 text-gray-600\">Loading product...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!product) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <Navbar />\n        <div className=\"text-center py-20\">\n          <i className=\"ri-shopping-bag-line text-5xl text-gray-300 mb-4\"></i>\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">Product not found</h3>\n          <Link to=\"/marketplace\" className=\"text-blue-600 hover:text-blue-700\">\n            Back to marketplace\n          </Link>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <Navbar />\n\n      <div className=\"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <Link\n          to=\"/marketplace\"\n          className=\"inline-flex items-center text-blue-600 hover:text-blue-700 mb-6 cursor-pointer\"\n        >\n          <i className=\"ri-arrow-left-line mr-2\"></i>\n          Back to marketplace\n        </Link>\n\n        <div className=\"bg-white rounded-2xl border border-gray-200 overflow-hidden\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8 p-8\">\n            <div className=\"aspect-square bg-gray-100 rounded-xl overflow-hidden\">\n              {product.images && product.images.length > 0 ? (\n                <img\n                  src={getOptimizedImageUrl(product.images[0], 800, 85)}\n                  alt={product.name}\n                  className=\"w-full h-full object-cover\"\n                  loading=\"eager\"\n                  decoding=\"async\"\n                  onError={(e) => {\n                    e.currentTarget.src = 'https://readdy.ai/api/search-image?query=product%20placeholder&width=800&height=800&seq=product-detail-placeholder&orientation=squarish';\n                  }}\n                />\n              ) : (\n                <div className=\"w-full h-full flex items-center justify-center\">\n                  <i className=\"ri-image-line text-6xl text-gray-300\"></i>\n                </div>\n              )}\n            </div>\n\n            <div className=\"flex flex-col\">\n              <div className=\"mb-4\">\n                <span className=\"px-3 py-1 bg-blue-100 text-blue-700 text-sm font-medium rounded-full\">\n                  {product.category}\n                </span>\n              </div>\n\n              <h1 className=\"text-3xl font-bold text-gray-900 mb-4\">\n                {product.name}\n              </h1>\n\n              <div className=\"mb-6\">\n                {product.price_type === 'fixed' ? (\n                  <p className=\"text-3xl font-bold text-blue-600\">\n                    GHâ‚µ {product.price?.toFixed(2)}\n                  </p>\n                ) : (\n                  <p className=\"text-xl font-semibold text-gray-600\">Contact for price</p>\n                )}\n              </div>\n\n              <div className=\"mb-6 pb-6 border-b border-gray-200\">\n                <h3 className=\"text-sm font-semibold text-gray-900 mb-2\">Description</h3>\n                <p className=\"text-gray-700 leading-relaxed\">\n                  {product.description || 'No description available'}\n                </p>\n              </div>\n\n              <div className=\"mb-6 pb-6 border-b border-gray-200\">\n                <h3 className=\"text-sm font-semibold text-gray-900 mb-3\">Seller Information</h3>\n                <div className=\"flex items-center space-x-3\">\n                  {product.seller?.avatar_url ? (\n                    <img\n                      src={product.seller.avatar_url}\n                      alt={product.seller.full_name}\n                      className=\"w-12 h-12 rounded-full object-cover border-2 border-blue-500\"\n                    />\n                  ) : (\n                    <div className=\"w-12 h-12 bg-gradient-to-br from-blue-500 to-yellow-400 rounded-full flex items-center justify-center\">\n                      <span className=\"text-white font-bold text-lg\">\n                        {product.seller?.full_name?.charAt(0).toUpperCase() || 'S'}\n                      </span>\n                    </div>\n                  )}\n                  <div>\n                    <p className=\"font-semibold text-gray-900\">{product.seller?.full_name || 'Unknown Seller'}</p>\n                    <p className=\"text-sm text-gray-600\">{product.seller?.department || 'Department not specified'}</p>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"space-y-3 mt-auto\">\n                <button\n                  onClick={handleWhatsAppContact}\n                  className=\"w-full px-6 py-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center space-x-2 whitespace-nowrap cursor-pointer\"\n                  disabled={!product?.whatsapp_number}\n                >\n                  <i className=\"ri-whatsapp-line text-xl\"></i>\n                  <span>Contact on WhatsApp</span>\n                </button>\n\n                <button\n                  onClick={handleInAppMessage}\n                  className=\"w-full px-6 py-4 bg-gray-900 text-white font-semibold rounded-lg hover:bg-gray-800 transition-colors flex items-center justify-center space-x-2 whitespace-nowrap cursor-pointer\"\n                >\n                  <i className=\"ri-message-line text-xl\"></i>\n                  <span>Send Message</span>\n                </button>\n              </div>\n\n              <p className=\"text-xs text-gray-500 mt-4 text-center\">\n                No payment on platform - contact seller directly to arrange payment\n              </p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":["ProductDetail","id","useParams","user","useAuth","navigate","useNavigate","product","setProduct","useState","loading","setLoading","useEffect","fetchProduct","data","error","supabase","handleWhatsAppContact","message","whatsappUrl","handleInAppMessage","existingConversation","jsxs","jsx","Navbar","Link","getOptimizedImageUrl","e"],"mappings":"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"}