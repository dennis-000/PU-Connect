{"version":3,"file":"Messages-BLYq4wLS.js","sources":["../../src/pages/messages/Messages.tsx"],"sourcesContent":["import { useState, useEffect, useRef } from 'react';\nimport { useAuth } from '../../contexts/AuthContext';\nimport { supabase } from '../../lib/supabase';\nimport Navbar from '../../components/feature/Navbar';\n\ninterface Message {\n  id: string;\n  conversation_id: string;\n  sender_id: string;\n  receiver_id: string;\n  message: string;\n  is_read: boolean;\n  created_at: string;\n}\n\ninterface Conversation {\n  id: string;\n  buyer_id: string;\n  seller_id: string;\n  product_id: string | null;\n  last_message: string | null;\n  last_message_at: string;\n  unread_count?: number;\n  buyer?: { id: string; full_name: string; email: string; is_online: boolean; last_seen: string; avatar_url?: string };\n  seller?: { id: string; full_name: string; email: string; is_online: boolean; last_seen: string; avatar_url?: string };\n  product?: { id: string; name: string };\n}\n\nexport default function Messages() {\n  const { user } = useAuth();\n  const [conversations, setConversations] = useState<Conversation[]>([]);\n  const [selectedConversation, setSelectedConversation] = useState<Conversation | null>(null);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [loading, setLoading] = useState(true);\n  const [sending, setSending] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [showConversationList, setShowConversationList] = useState(true);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (user) {\n      fetchConversations();\n      \n      // Refresh conversations every 10 seconds to update online status\n      const interval = setInterval(fetchConversations, 10000);\n      return () => clearInterval(interval);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [user]);\n\n  useEffect(() => {\n    if (selectedConversation) {\n      fetchMessages(selectedConversation.id);\n      markMessagesAsRead(selectedConversation.id);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedConversation]);\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  const handleConversationSelect = (conversation: Conversation) => {\n    setSelectedConversation(conversation);\n    setShowConversationList(false);\n  };\n\n  const handleBackToList = () => {\n    setShowConversationList(true);\n    setSelectedConversation(null);\n  };\n\n  const fetchConversations = async () => {\n    setLoading(true);\n    setError(null);\n    try {\n      const { data, error } = await supabase\n        .from('conversations')\n        .select(`\n          *,\n          buyer:profiles!buyer_id(id, full_name, email, is_online, last_seen, avatar_url),\n          seller:profiles!seller_id(id, full_name, email, is_online, last_seen, avatar_url),\n          product:products(id, name)\n        `)\n        .or(`buyer_id.eq.${user?.id},seller_id.eq.${user?.id}`)\n        .order('last_message_at', { ascending: false });\n\n      if (error) {\n        throw error;\n      }\n      \n      if (data) {\n        // Optimize: Fetch all unread counts in a single query instead of N+1\n        const conversationIds = data.map(conv => conv.id);\n        \n        if (conversationIds.length > 0) {\n          const { data: unreadMessages } = await supabase\n            .from('messages')\n            .select('conversation_id')\n            .in('conversation_id', conversationIds)\n            .eq('receiver_id', user?.id)\n            .eq('is_read', false);\n\n          // Count unread messages per conversation\n          const unreadCounts = unreadMessages?.reduce((acc, msg) => {\n            acc[msg.conversation_id] = (acc[msg.conversation_id] || 0) + 1;\n            return acc;\n          }, {} as Record<string, number>) || {};\n\n          const conversationsWithUnread = data.map(conv => ({\n            ...conv,\n            unread_count: unreadCounts[conv.id] || 0\n          }));\n\n          setConversations(conversationsWithUnread as any);\n          if (conversationsWithUnread.length > 0 && !selectedConversation) {\n            setSelectedConversation(conversationsWithUnread[0] as any);\n          }\n        } else {\n          setConversations(data as any);\n        }\n      }\n    } catch (err) {\n      setError('Failed to load conversations. Please try again.');\n      console.error('Error fetching conversations:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchMessages = async (conversationId: string) => {\n    try {\n      const { data, error } = await supabase\n        .from('messages')\n        .select('*')\n        .eq('conversation_id', conversationId)\n        .order('created_at', { ascending: true });\n\n      if (error) {\n        throw error;\n      }\n      \n      if (data) {\n        setMessages(data);\n      }\n    } catch (err) {\n      console.error('Error fetching messages:', err);\n    }\n  };\n\n  const markMessagesAsRead = async (conversationId: string) => {\n    try {\n      await supabase\n        .from('messages')\n        .update({ is_read: true })\n        .eq('conversation_id', conversationId)\n        .eq('receiver_id', user?.id)\n        .eq('is_read', false);\n    } catch (err) {\n      console.error('Error marking messages as read:', err);\n    }\n  };\n\n  const sendMessage = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!newMessage.trim() || !selectedConversation || !user) return;\n\n    setSending(true);\n    setError(null);\n    \n    try {\n      const receiverId = selectedConversation.buyer_id === user.id \n        ? selectedConversation.seller_id \n        : selectedConversation.buyer_id;\n\n      const { data, error } = await supabase\n        .from('messages')\n        .insert({\n          conversation_id: selectedConversation.id,\n          sender_id: user.id,\n          receiver_id: receiverId,\n          product_id: selectedConversation.product_id,\n          message: newMessage.trim(),\n        })\n        .select()\n        .single();\n\n      if (error) {\n        throw error;\n      }\n\n      if (data) {\n        setMessages([...messages, data]);\n        setNewMessage('');\n        \n        const { error: updateError } = await supabase\n          .from('conversations')\n          .update({\n            last_message: newMessage.trim(),\n            last_message_at: new Date().toISOString(),\n          })\n          .eq('id', selectedConversation.id);\n\n        if (updateError) {\n          throw updateError;\n        }\n\n        fetchConversations();\n      }\n    } catch (err) {\n      setError('Failed to send message. Please try again.');\n      console.error('Error sending message:', err);\n    } finally {\n      setSending(false);\n    }\n  };\n\n  const getOtherUser = (conversation: Conversation) => {\n    return conversation.buyer_id === user?.id ? conversation.seller : conversation.buyer;\n  };\n\n  const getOnlineStatus = (user: any) => {\n    if (!user) return { isOnline: false, text: 'Offline' };\n    \n    if (user.is_online) {\n      return { isOnline: true, text: 'Online' };\n    }\n    \n    const lastSeen = new Date(user.last_seen);\n    const now = new Date();\n    const diffMinutes = Math.floor((now.getTime() - lastSeen.getTime()) / 60000);\n    \n    if (diffMinutes < 5) return { isOnline: false, text: 'Active recently' };\n    if (diffMinutes < 60) return { isOnline: false, text: `Active ${diffMinutes}m ago` };\n    if (diffMinutes < 1440) return { isOnline: false, text: `Active ${Math.floor(diffMinutes / 60)}h ago` };\n    return { isOnline: false, text: `Active ${Math.floor(diffMinutes / 1440)}d ago` };\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <Navbar />\n\n      <div className=\"max-w-7xl mx-auto px-2 sm:px-4 lg:px-8 py-4 sm:py-8 mt-16\">\n        <div className=\"mb-4 sm:mb-6\">\n          <h1 className=\"text-2xl sm:text-3xl font-bold text-gray-900 mb-1 sm:mb-2\">Messages</h1>\n          <p className=\"text-sm sm:text-base text-gray-600\">Chat with buyers and sellers</p>\n        </div>\n\n        {error && (\n          <div className=\"mb-4 p-3 sm:p-4 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm\">\n            {error}\n          </div>\n        )}\n\n        <div className=\"bg-white rounded-xl border border-gray-200 overflow-hidden\" style={{ height: 'calc(100vh - 200px)' }}>\n          <div className=\"grid grid-cols-1 lg:grid-cols-12 h-full\">\n            {/* Conversations List - Mobile: Show/Hide based on selection */}\n            <div className={`${showConversationList ? 'block' : 'hidden'} lg:block lg:col-span-4 border-r border-gray-200 overflow-y-auto`}>\n              {loading ? (\n                <div className=\"flex items-center justify-center h-full\">\n                  <div className=\"w-8 h-8 border-4 border-gray-200 border-t-blue-600 rounded-full animate-spin\"></div>\n                </div>\n              ) : conversations.length === 0 ? (\n                <div className=\"flex flex-col items-center justify-center h-full p-6 text-center\">\n                  <i className=\"ri-message-3-line text-4xl sm:text-5xl text-gray-300 mb-4\"></i>\n                  <h3 className=\"text-base sm:text-lg font-semibold text-gray-900 mb-2\">No conversations yet</h3>\n                  <p className=\"text-xs sm:text-sm text-gray-600\">Start chatting with sellers or buyers</p>\n                </div>\n              ) : (\n                <div>\n                  {conversations.map((conversation) => {\n                    const otherUser = getOtherUser(conversation);\n                    const status = getOnlineStatus(otherUser);\n                    const hasUnread = (conversation.unread_count || 0) > 0;\n                    return (\n                      <div\n                        key={conversation.id}\n                        onClick={() => handleConversationSelect(conversation)}\n                        className={`p-4 border-b border-gray-200 hover:bg-gray-50 transition-colors cursor-pointer relative ${\n                          selectedConversation?.id === conversation.id ? 'bg-blue-50 border-l-4 border-l-blue-600' : ''\n                        } ${hasUnread ? 'bg-blue-50/30' : ''}`}\n                      >\n                        <div className=\"flex items-start space-x-3\">\n                          <div className=\"relative flex-shrink-0\">\n                            {otherUser?.avatar_url ? (\n                              <img\n                                src={otherUser.avatar_url}\n                                alt={otherUser.full_name}\n                                className=\"w-10 h-10 sm:w-12 sm:h-12 rounded-full object-cover border-2 border-blue-500\"\n                              />\n                            ) : (\n                              <div className=\"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-blue-500 to-yellow-400 rounded-full flex items-center justify-center\">\n                                <span className=\"text-white font-bold text-xs sm:text-sm\">\n                                  {otherUser?.full_name?.charAt(0).toUpperCase()}\n                                </span>\n                              </div>\n                            )}\n                            {status.isOnline && (\n                              <div className=\"absolute bottom-0 right-0 w-3 h-3 sm:w-3.5 sm:h-3.5 bg-green-500 border-2 border-white rounded-full\"></div>\n                            )}\n                          </div>\n                          <div className=\"flex-1 min-w-0\">\n                            <div className=\"flex items-center justify-between mb-1\">\n                              <h3 className={`text-xs sm:text-sm truncate ${hasUnread ? 'font-bold text-gray-900' : 'font-semibold text-gray-900'}`}>\n                                {otherUser?.full_name}\n                              </h3>\n                              <div className=\"flex items-center space-x-2\">\n                                <span className=\"text-xs text-gray-500\">\n                                  {new Date(conversation.last_message_at).toLocaleDateString()}\n                                </span>\n                                {hasUnread && (\n                                  <span className=\"w-5 h-5 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center flex-shrink-0\">\n                                    {conversation.unread_count! > 9 ? '9+' : conversation.unread_count}\n                                  </span>\n                                )}\n                              </div>\n                            </div>\n                            <p className=\"text-xs text-blue-600 mb-1\">{status.text}</p>\n                            {conversation.product && (\n                              <p className=\"text-xs text-gray-500 mb-1 truncate\">\n                                Re: {conversation.product.name}\n                              </p>\n                            )}\n                            <p className={`text-xs sm:text-sm truncate ${hasUnread ? 'font-semibold text-gray-900' : 'text-gray-600'}`}>\n                              {conversation.last_message || 'No messages yet'}\n                            </p>\n                          </div>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              )}\n            </div>\n\n            {/* Messages Area - Mobile: Show/Hide based on selection */}\n            <div className={`${!showConversationList ? 'block' : 'hidden'} lg:block lg:col-span-8 flex flex-col`}>\n              {selectedConversation ? (\n                <>\n                  {/* Chat Header */}\n                  <div className=\"p-3 sm:p-4 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-yellow-50\">\n                    <div className=\"flex items-center space-x-3\">\n                      {/* Back Button - Mobile Only */}\n                      <button\n                        onClick={handleBackToList}\n                        className=\"lg:hidden p-2 hover:bg-white rounded-lg transition-colors cursor-pointer\"\n                      >\n                        <i className=\"ri-arrow-left-line text-xl text-gray-700\"></i>\n                      </button>\n                      \n                      <div className=\"relative\">\n                        {getOtherUser(selectedConversation)?.avatar_url ? (\n                          <img\n                            src={getOtherUser(selectedConversation)?.avatar_url}\n                            alt={getOtherUser(selectedConversation)?.full_name}\n                            className=\"w-8 h-8 sm:w-10 sm:h-10 rounded-full object-cover border-2 border-blue-500\"\n                          />\n                        ) : (\n                          <div className=\"w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-br from-blue-500 to-yellow-400 rounded-full flex items-center justify-center\">\n                            <span className=\"text-white font-bold text-xs sm:text-sm\">\n                              {getOtherUser(selectedConversation)?.full_name?.charAt(0).toUpperCase()}\n                            </span>\n                          </div>\n                        )}\n                        {getOnlineStatus(getOtherUser(selectedConversation)).isOnline && (\n                          <div className=\"absolute bottom-0 right-0 w-2.5 h-2.5 sm:w-3 sm:h-3 bg-green-500 border-2 border-white rounded-full\"></div>\n                        )}\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <h3 className=\"text-sm sm:text-base font-semibold text-gray-900 truncate\">\n                          {getOtherUser(selectedConversation)?.full_name}\n                        </h3>\n                        <p className=\"text-xs text-blue-600 font-medium\">\n                          {getOnlineStatus(getOtherUser(selectedConversation)).text}\n                        </p>\n                        {selectedConversation.product && (\n                          <p className=\"text-xs text-gray-600 mt-0.5 truncate\">\n                            About: {selectedConversation.product.name}\n                          </p>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Messages */}\n                  <div className=\"flex-1 overflow-y-auto p-3 sm:p-4 space-y-3 sm:space-y-4\">\n                    {messages.map((message) => {\n                      const isSender = message.sender_id === user?.id;\n                      return (\n                        <div\n                          key={message.id}\n                          className={`flex ${isSender ? 'justify-end' : 'justify-start'}`}\n                        >\n                          <div\n                            className={`max-w-[85%] sm:max-w-xs lg:max-w-md px-3 sm:px-4 py-2 rounded-2xl ${\n                              isSender\n                                ? 'bg-gradient-to-r from-blue-500 to-blue-600 text-white'\n                                : 'bg-gray-100 text-gray-900'\n                            }`}\n                          >\n                            <p className=\"text-xs sm:text-sm break-words\">{message.message}</p>\n                            <p\n                              className={`text-xs mt-1 ${\n                                isSender ? 'text-blue-100' : 'text-gray-500'\n                              }`}\n                            >\n                              {new Date(message.created_at).toLocaleTimeString([], {\n                                hour: '2-digit',\n                                minute: '2-digit',\n                              })}\n                            </p>\n                          </div>\n                        </div>\n                      );\n                    })}\n                    <div ref={messagesEndRef} />\n                  </div>\n\n                  {/* Message Input */}\n                  <form onSubmit={sendMessage} className=\"p-3 sm:p-4 border-t border-gray-200 bg-gray-50\">\n                    <div className=\"flex space-x-2 sm:space-x-3\">\n                      <input\n                        type=\"text\"\n                        value={newMessage}\n                        onChange={(e) => setNewMessage(e.target.value)}\n                        placeholder=\"Type your message...\"\n                        className=\"flex-1 px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent text-xs sm:text-sm\"\n                        disabled={sending}\n                      />\n                      <button\n                        type=\"submit\"\n                        disabled={sending || !newMessage.trim()}\n                        className=\"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all font-semibold disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer whitespace-nowrap\"\n                      >\n                        {sending ? (\n                          <>\n                            <i className=\"ri-loader-4-line animate-spin mr-2\"></i>\n                            Sending...\n                          </>\n                        ) : (\n                          <>\n                            <i className=\"ri-send-plane-fill mr-2\"></i>\n                            Send\n                          </>\n                        )}\n                      </button>\n                    </div>\n                  </form>\n                </>\n              ) : (\n                <div className=\"flex items-center justify-center h-full p-4\">\n                  <div className=\"text-center\">\n                    <i className=\"ri-chat-3-line text-4xl sm:text-5xl text-gray-300 mb-4\"></i>\n                    <h3 className=\"text-base sm:text-lg font-semibold text-gray-900 mb-2\">Select a conversation</h3>\n                    <p className=\"text-xs sm:text-sm text-gray-600\">Choose a conversation to start messaging</p>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":["Messages","user","useAuth","conversations","setConversations","useState","selectedConversation","setSelectedConversation","messages","setMessages","newMessage","setNewMessage","loading","setLoading","sending","setSending","error","setError","showConversationList","setShowConversationList","messagesEndRef","useRef","useEffect","fetchConversations","interval","fetchMessages","markMessagesAsRead","scrollToBottom","handleConversationSelect","conversation","handleBackToList","data","supabase","conversationIds","conv","unreadMessages","unreadCounts","acc","msg","conversationsWithUnread","err","conversationId","sendMessage","e","receiverId","updateError","getOtherUser","getOnlineStatus","lastSeen","diffMinutes","jsxs","jsx","Navbar","otherUser","status","hasUnread","Fragment","message","isSender"],"mappings":"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"}