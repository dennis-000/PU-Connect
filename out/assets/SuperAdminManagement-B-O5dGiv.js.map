{"version":3,"file":"SuperAdminManagement-B-O5dGiv.js","sources":["../../src/pages/admin/SuperAdminManagement.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useAuth } from '../../contexts/AuthContext';\nimport { supabase } from '../../lib/supabase';\nimport Navbar from '../../components/feature/Navbar';\n\ntype SystemAdmin = {\n  id: string;\n  user_id: string;\n  granted_at: string;\n  is_active: boolean;\n  profile?: {\n    full_name: string;\n    email: string;\n    avatar_url?: string;\n  };\n};\n\nexport default function SuperAdminManagement() {\n  const { profile } = useAuth();\n  const navigate = useNavigate();\n  const [admins, setAdmins] = useState<SystemAdmin[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchEmail, setSearchEmail] = useState('');\n  const [message, setMessage] = useState('');\n  const [messageType, setMessageType] = useState<'success' | 'error'>('success');\n\n  useEffect(() => {\n    if (profile?.role !== 'super_admin') {\n      navigate('/admin/dashboard');\n      return;\n    }\n    fetchAdmins();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [profile, navigate]);\n\n  const fetchAdmins = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('system_admins')\n        .select(`\n          *,\n          profile:profiles!system_admins_user_id_fkey(full_name, email, avatar_url)\n        `)\n        .order('granted_at', { ascending: false });\n\n      if (error) throw error;\n      setAdmins(data || []);\n    } catch (error: any) {\n      console.error('Error fetching admins:', error);\n      showMessage('Failed to load admins', 'error');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const showMessage = (msg: string, type: 'success' | 'error') => {\n    setMessage(msg);\n    setMessageType(type);\n    setTimeout(() => setMessage(''), 5000);\n  };\n\n  const grantSuperAdmin = async () => {\n    if (!searchEmail.trim()) {\n      showMessage('Please enter an email address', 'error');\n      return;\n    }\n\n    setLoading(true);\n    try {\n      // Find user by email\n      const { data: userProfile, error: findError } = await supabase\n        .from('profiles')\n        .select('id, email, full_name, role')\n        .eq('email', searchEmail.trim())\n        .single();\n\n      if (findError || !userProfile) {\n        showMessage('User not found with this email', 'error');\n        setLoading(false);\n        return;\n      }\n\n      // Update user role to super_admin\n      const { error: updateError } = await supabase\n        .from('profiles')\n        .update({ role: 'super_admin' })\n        .eq('id', userProfile.id);\n\n      if (updateError) throw updateError;\n\n      // Add to system_admins table\n      const { error: insertError } = await supabase\n        .from('system_admins')\n        .insert({\n          user_id: userProfile.id,\n          granted_by: profile?.id,\n          is_active: true\n        });\n\n      if (insertError) throw insertError;\n\n      showMessage(`Successfully granted super admin access to ${userProfile.full_name}`, 'success');\n      setSearchEmail('');\n      fetchAdmins();\n    } catch (error: any) {\n      console.error('Error granting super admin:', error);\n      showMessage(error.message || 'Failed to grant super admin access', 'error');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const toggleAdminStatus = async (adminId: string, currentStatus: boolean) => {\n    try {\n      const { error } = await supabase\n        .from('system_admins')\n        .update({ is_active: !currentStatus })\n        .eq('id', adminId);\n\n      if (error) throw error;\n\n      showMessage(`Admin status ${!currentStatus ? 'activated' : 'deactivated'} successfully`, 'success');\n      fetchAdmins();\n    } catch (error: any) {\n      console.error('Error updating admin status:', error);\n      showMessage('Failed to update admin status', 'error');\n    }\n  };\n\n  if (profile?.role !== 'super_admin') {\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-50\">\n      <Navbar />\n\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <div className=\"flex items-center space-x-3 mb-2\">\n            <div className=\"w-12 h-12 bg-gradient-to-br from-purple-600 to-pink-600 rounded-xl flex items-center justify-center\">\n              <i className=\"ri-shield-star-line text-white text-2xl\"></i>\n            </div>\n            <div>\n              <h1 className=\"text-3xl font-bold text-slate-900\">Super Admin Management</h1>\n              <p className=\"text-slate-600 text-sm\">Manage system administrators with full access</p>\n            </div>\n          </div>\n        </div>\n\n        {/* Message */}\n        {message && (\n          <div className={`mb-6 p-4 rounded-xl border ${\n            messageType === 'success' \n              ? 'bg-green-50 border-green-200 text-green-800'\n              : 'bg-red-50 border-red-200 text-red-800'\n          }`}>\n            <div className=\"flex items-center space-x-2\">\n              <i className={`${messageType === 'success' ? 'ri-check-line' : 'ri-error-warning-line'} text-lg`}></i>\n              <p className=\"text-sm font-medium\">{message}</p>\n            </div>\n          </div>\n        )}\n\n        {/* Grant Super Admin */}\n        <div className=\"bg-white rounded-2xl border border-slate-200 p-6 mb-8 shadow-sm\">\n          <h2 className=\"text-lg font-bold text-slate-900 mb-4 flex items-center\">\n            <i className=\"ri-user-add-line mr-2 text-purple-600\"></i>\n            Grant Super Admin Access\n          </h2>\n          <div className=\"flex space-x-3\">\n            <input\n              type=\"email\"\n              value={searchEmail}\n              onChange={(e) => setSearchEmail(e.target.value)}\n              placeholder=\"Enter user email address\"\n              className=\"flex-1 px-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm\"\n            />\n            <button\n              onClick={grantSuperAdmin}\n              disabled={loading || !searchEmail.trim()}\n              className=\"px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl hover:from-purple-700 hover:to-pink-700 transition-all font-medium text-sm whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer\"\n            >\n              <i className=\"ri-shield-check-line mr-2\"></i>\n              Grant Access\n            </button>\n          </div>\n        </div>\n\n        {/* Super Admins List */}\n        <div className=\"bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden\">\n          <div className=\"p-6 border-b border-slate-200\">\n            <h2 className=\"text-lg font-bold text-slate-900 flex items-center\">\n              <i className=\"ri-shield-user-line mr-2 text-purple-600\"></i>\n              System Administrators ({admins.length})\n            </h2>\n          </div>\n\n          {loading ? (\n            <div className=\"p-12 text-center\">\n              <i className=\"ri-loader-4-line text-4xl text-slate-400 animate-spin\"></i>\n              <p className=\"text-slate-600 mt-4\">Loading administrators...</p>\n            </div>\n          ) : admins.length === 0 ? (\n            <div className=\"p-12 text-center\">\n              <i className=\"ri-shield-user-line text-6xl text-slate-300\"></i>\n              <p className=\"text-slate-600 mt-4\">No super admins found</p>\n            </div>\n          ) : (\n            <div className=\"divide-y divide-slate-200\">\n              {admins.map((admin) => (\n                <div key={admin.id} className=\"p-6 hover:bg-slate-50 transition-colors\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center space-x-4\">\n                      <div className=\"w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center\">\n                        {admin.profile?.avatar_url ? (\n                          <img\n                            src={admin.profile.avatar_url}\n                            alt={admin.profile.full_name}\n                            className=\"w-full h-full rounded-full object-cover\"\n                          />\n                        ) : (\n                          <span className=\"text-white font-bold text-lg\">\n                            {admin.profile?.full_name?.charAt(0) || 'A'}\n                          </span>\n                        )}\n                      </div>\n                      <div>\n                        <h3 className=\"font-semibold text-slate-900\">{admin.profile?.full_name || 'Unknown'}</h3>\n                        <p className=\"text-sm text-slate-600\">{admin.profile?.email || 'No email'}</p>\n                        <p className=\"text-xs text-slate-500 mt-1\">\n                          Granted: {new Date(admin.granted_at).toLocaleDateString()}\n                        </p>\n                      </div>\n                    </div>\n\n                    <div className=\"flex items-center space-x-3\">\n                      <span className={`px-3 py-1 text-xs font-medium rounded-full ${\n                        admin.is_active\n                          ? 'bg-green-100 text-green-700'\n                          : 'bg-red-100 text-red-700'\n                      }`}>\n                        {admin.is_active ? 'Active' : 'Inactive'}\n                      </span>\n                      <button\n                        onClick={() => toggleAdminStatus(admin.id, admin.is_active)}\n                        className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap cursor-pointer ${\n                          admin.is_active\n                            ? 'bg-red-100 text-red-700 hover:bg-red-200'\n                            : 'bg-green-100 text-green-700 hover:bg-green-200'\n                        }`}\n                      >\n                        {admin.is_active ? 'Deactivate' : 'Activate'}\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":["SuperAdminManagement","profile","useAuth","navigate","useNavigate","admins","setAdmins","useState","loading","setLoading","searchEmail","setSearchEmail","message","setMessage","messageType","setMessageType","useEffect","fetchAdmins","data","error","supabase","showMessage","msg","type","grantSuperAdmin","userProfile","findError","updateError","insertError","toggleAdminStatus","adminId","currentStatus","jsxs","jsx","Navbar","e","admin"],"mappings":"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"}