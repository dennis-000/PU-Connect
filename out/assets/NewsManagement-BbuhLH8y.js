import{j as e}from"./query-vendor-C4XoQ8tj.js";import{u as E,r as n}from"./react-vendor-BpnWQj_L.js";import{u as q,s as u,N as A}from"./index-BvprY0-k.js";import"./i18n-vendor-BT3zpxCT.js";import"./supabase-vendor-NSJvwn9b.js";function M(){const{profile:o}=q(),g=E(),[m,N]=n.useState([]),[v,b]=n.useState(!0),[l,h]=n.useState("all");n.useEffect(()=>{(o?.role==="admin"||o?.role==="news_publisher")&&c()},[l]);const[k,d]=n.useState(!1),[x,p]=n.useState(null),[a,i]=n.useState({title:"",content:"",category:"General",image_url:"",status:"draft"}),[f,y]=n.useState(!1);n.useEffect(()=>{if(o?.role!=="admin"&&o?.role!=="news_publisher"){g("/marketplace");return}c()},[o,g]);const c=async()=>{b(!0);try{let s=u.from("campus_news").select("*, author:profiles!author_id(full_name)").order("created_at",{ascending:!1});l==="published"?s=s.eq("status","published"):l==="draft"&&(s=s.eq("status","draft"));const{data:t,error:r}=await s;if(r)throw r;N(t||[])}catch(s){console.error("Error fetching news:",s)}finally{b(!1)}},_=async s=>{s.preventDefault(),y(!0);try{const t={...a,author_id:o?.id,published_at:a.status==="published"?new Date().toISOString():null};if(x){const{error:r}=await u.from("campus_news").update(t).eq("id",x.id);if(r)throw r}else{const{error:r}=await u.from("campus_news").insert([t]);if(r)throw r}d(!1),p(null),i({title:"",content:"",category:"General",image_url:"",status:"draft"}),c()}catch(t){alert(t.message||"Failed to save news")}finally{y(!1)}},C=s=>{p(s),i({title:s.title,content:s.content,category:s.category,image_url:s.image_url||"",status:s.status}),d(!0)},S=async s=>{if(confirm("Are you sure you want to delete this news article?"))try{const{error:t}=await u.from("campus_news").delete().eq("id",s);if(t)throw t;c()}catch(t){alert(t.message||"Failed to delete news")}},D=async(s,t)=>{try{const r=t==="published"?"draft":"published",{error:j}=await u.from("campus_news").update({status:r,published_at:r==="published"?new Date().toISOString():null}).eq("id",s);if(j)throw j;c()}catch(r){alert(r.message||"Failed to update status")}},w=m.filter(s=>l==="all"?!0:s.status===l);return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(A,{}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"News Management"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Create and manage campus news articles"})]}),e.jsxs("button",{onClick:()=>{p(null),i({title:"",content:"",category:"General",image_url:"",status:"draft"}),d(!0)},className:"px-6 py-3 bg-sky-600 text-white rounded-lg hover:bg-sky-700 transition-colors font-medium whitespace-nowrap cursor-pointer",children:[e.jsx("i",{className:"ri-add-line mr-2"}),"Create News"]})]}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-2 mb-6",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>h("all"),className:`px-4 py-2 text-sm font-medium rounded-lg transition-colors whitespace-nowrap cursor-pointer ${l==="all"?"bg-sky-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:["All (",m.length,")"]}),e.jsxs("button",{onClick:()=>h("published"),className:`px-4 py-2 text-sm font-medium rounded-lg transition-colors whitespace-nowrap cursor-pointer ${l==="published"?"bg-sky-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:["Published (",m.filter(s=>s.status==="published").length,")"]}),e.jsxs("button",{onClick:()=>h("draft"),className:`px-4 py-2 text-sm font-medium rounded-lg transition-colors whitespace-nowrap cursor-pointer ${l==="draft"?"bg-sky-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:["Drafts (",m.filter(s=>s.status==="draft").length,")"]})]})}),v?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block w-10 h-10 border-4 border-gray-200 border-t-sky-600 rounded-full animate-spin"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading news..."})]}):w.length===0?e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-12 text-center",children:[e.jsx("i",{className:"ri-newspaper-line text-5xl text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No news articles"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Get started by creating your first news article"}),e.jsx("button",{onClick:()=>d(!0),className:"px-6 py-3 bg-sky-600 text-white rounded-lg hover:bg-sky-700 transition-colors font-medium whitespace-nowrap cursor-pointer",children:"Create News"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-6",children:w.map(s=>e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex",children:[s.image_url&&e.jsx("div",{className:"w-48 h-48 flex-shrink-0",children:e.jsx("img",{src:s.image_url,alt:s.title,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("span",{className:"px-3 py-1 bg-sky-100 text-sky-700 text-xs font-medium rounded-full",children:s.category}),e.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full ${s.status==="published"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:s.status==="published"?"Published":"Draft"})]}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:s.title}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mb-3",children:s.content}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[e.jsxs("span",{children:[e.jsx("i",{className:"ri-user-line mr-1"}),s.author?.full_name]}),e.jsxs("span",{children:[e.jsx("i",{className:"ri-eye-line mr-1"}),s.views," views"]}),e.jsxs("span",{children:[e.jsx("i",{className:"ri-calendar-line mr-1"}),new Date(s.created_at).toLocaleDateString()]})]})]})}),e.jsxs("div",{className:"flex space-x-3 pt-4 border-t border-gray-200",children:[e.jsxs("button",{onClick:()=>C(s),className:"px-4 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-200 transition-colors whitespace-nowrap cursor-pointer",children:[e.jsx("i",{className:"ri-edit-line mr-2"}),"Edit"]}),e.jsxs("button",{onClick:()=>D(s.id,s.status),className:`px-4 py-2 text-sm font-medium rounded-lg transition-colors whitespace-nowrap cursor-pointer ${s.status==="published"?"bg-amber-100 text-amber-700 hover:bg-amber-200":"bg-green-100 text-green-700 hover:bg-green-200"}`,children:[e.jsx("i",{className:`${s.status==="published"?"ri-eye-off-line":"ri-send-plane-line"} mr-2`}),s.status==="published"?"Unpublish":"Publish"]}),e.jsxs("button",{onClick:()=>S(s.id),className:"px-4 py-2 bg-red-100 text-red-700 text-sm font-medium rounded-lg hover:bg-red-200 transition-colors whitespace-nowrap cursor-pointer",children:[e.jsx("i",{className:"ri-delete-bin-line mr-2"}),"Delete"]})]})]})]})},s.id))})]}),k&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:x?"Edit News Article":"Create News Article"}),e.jsx("button",{onClick:()=>d(!1),className:"text-gray-400 hover:text-gray-600 cursor-pointer",children:e.jsx("i",{className:"ri-close-line text-2xl"})})]}),e.jsxs("form",{onSubmit:_,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Title *"}),e.jsx("input",{type:"text",value:a.title,onChange:s=>i({...a,title:s.target.value}),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"Enter news title"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category *"}),e.jsxs("select",{value:a.category,onChange:s=>i({...a,category:s.target.value}),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent cursor-pointer",children:[e.jsx("option",{value:"General",children:"General"}),e.jsx("option",{value:"Events",children:"Events"}),e.jsx("option",{value:"Academic",children:"Academic"}),e.jsx("option",{value:"Sports",children:"Sports"}),e.jsx("option",{value:"Announcements",children:"Announcements"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Content *"}),e.jsx("textarea",{value:a.content,onChange:s=>i({...a,content:s.target.value}),required:!0,rows:8,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent resize-none",placeholder:"Write your news content here..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Image URL"}),e.jsx("input",{type:"url",value:a.image_url,onChange:s=>i({...a,image_url:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"https://example.com/image.jpg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status *"}),e.jsxs("select",{value:a.status,onChange:s=>i({...a,status:s.target.value}),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent cursor-pointer",children:[e.jsx("option",{value:"draft",children:"Save as Draft"}),e.jsx("option",{value:"published",children:"Publish Now"})]})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>d(!1),className:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium whitespace-nowrap cursor-pointer",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:f,className:"flex-1 px-4 py-3 bg-sky-600 text-white rounded-lg hover:bg-sky-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap cursor-pointer",children:f?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-loader-4-line animate-spin mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-save-line mr-2"}),x?"Update":"Create"]})})]})]})]})})]})}export{M as default};
//# sourceMappingURL=NewsManagement-BbuhLH8y.js.map
