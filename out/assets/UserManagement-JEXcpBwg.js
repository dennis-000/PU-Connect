import{j as e}from"./query-vendor-C4XoQ8tj.js";import{u as B,r as l}from"./react-vendor-BpnWQj_L.js";import{u as I,s as m,N as P}from"./index-BvprY0-k.js";import"./i18n-vendor-BT3zpxCT.js";import"./supabase-vendor-NSJvwn9b.js";function H(){const j=B(),{profile:y,loading:h}=I(),[i,C]=l.useState([]),[_,U]=l.useState(!0),[d,E]=l.useState(""),[p,D]=l.useState("all"),[b,n]=l.useState(null),[c,N]=l.useState(null),[R,o]=l.useState(!1),[u,w]=l.useState(""),[v,S]=l.useState(!1),[A,k]=l.useState(!1);l.useEffect(()=>{!h&&y?.role!=="admin"&&j("/")},[y,h,j]),l.useEffect(()=>{x()},[]);const x=async()=>{try{const{data:t,error:s}=await m.from("profiles").select("*").order("created_at",{ascending:!1});if(s)throw s;C(t||[])}catch(t){console.error("Error fetching users:",t)}finally{U(!1)}},L=async(t,s)=>{try{const{error:r}=await m.from("profiles").update({is_active:!s}).eq("id",t);if(r)throw r;await x(),n(null),alert(`User ${s?"suspended":"activated"} successfully`)}catch(r){console.error("Error updating user status:",r),alert("Failed to update user status")}},F=async t=>{if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{const{error:s}=await m.from("profiles").delete().eq("id",t);if(s)throw s;await x(),n(null),alert("User deleted successfully")}catch(s){console.error("Error deleting user:",s),alert("Failed to delete user")}},T=t=>{N(t),w(t.role),o(!0),n(null)},M=async()=>{if(c){S(!0);try{const{error:t}=await m.from("profiles").update({role:u}).eq("id",c.id);if(t)throw t;await x(),o(!1),N(null),k(!0),setTimeout(()=>k(!1),3e3)}catch(t){console.error("Error updating role:",t),alert("Failed to update user role")}finally{S(!1)}}},z=()=>{const t=[["Email","Full Name","Student ID","Department","Faculty","Role","Status","Created At"],...g.map(a=>[a.email,a.full_name,a.student_id||"",a.department||"",a.faculty||"",a.role,a.is_active?"Active":"Suspended",new Date(a.created_at).toLocaleDateString()])].map(a=>a.join(",")).join(`
`),s=new Blob([t],{type:"text/csv"}),r=window.URL.createObjectURL(s),f=document.createElement("a");f.href=r,f.download=`users-${new Date().toISOString().split("T")[0]}.csv`,f.click()},g=i.filter(t=>{const s=t.email.toLowerCase().includes(d.toLowerCase())||t.full_name.toLowerCase().includes(d.toLowerCase())||t.student_id&&t.student_id.toLowerCase().includes(d.toLowerCase()),r=p==="all"||t.role===p;return s&&r});return h||_?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-loader-4-line text-4xl text-teal-600 animate-spin"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(P,{}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"User Management"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Manage all platform users and their roles"})]}),e.jsxs("button",{onClick:z,className:"flex items-center gap-2 px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors whitespace-nowrap cursor-pointer",children:[e.jsx("i",{className:"ri-download-line"}),"Export Data"]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search Users"}),e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:"ri-search-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:d,onChange:t=>E(t.target.value),placeholder:"Search by name, email, or student ID...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Role"}),e.jsxs("select",{value:p,onChange:t=>D(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent text-sm cursor-pointer",children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"buyer",children:"Buyers"}),e.jsx("option",{value:"seller",children:"Sellers"}),e.jsx("option",{value:"admin",children:"Admins"}),e.jsx("option",{value:"news_publisher",children:"News Publishers"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:i.length})]}),e.jsx("div",{className:"w-12 h-12 bg-teal-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-user-line text-2xl text-teal-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Buyers"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:i.filter(t=>t.role==="buyer").length})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-shopping-bag-line text-2xl text-blue-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Sellers"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:i.filter(t=>t.role==="seller").length})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-store-line text-2xl text-green-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Admins"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:i.filter(t=>t.role==="admin").length})]}),e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-shield-user-line text-2xl text-orange-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"News Publishers"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:i.filter(t=>t.role==="news_publisher").length})]}),e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-newspaper-line text-2xl text-purple-600"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Student ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Department"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Joined"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:g.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-teal-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-teal-600 font-medium text-sm",children:t.full_name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.full_name}),e.jsx("div",{className:"text-sm text-gray-500",children:t.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:t.student_id||"-"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:t.department||"-"}),t.faculty&&e.jsx("div",{className:"text-sm text-gray-500",children:t.faculty})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${t.role==="admin"?"bg-orange-100 text-orange-800":t.role==="seller"?"bg-green-100 text-green-800":t.role==="news_publisher"?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:t.role==="news_publisher"?"News Publisher":t.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${t.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.is_active?"Active":"Suspended"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(t.created_at).toLocaleDateString()}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 relative",children:[e.jsx("button",{onClick:()=>n(b===t.id?null:t.id),className:"text-sm text-gray-600 hover:text-gray-900 cursor-pointer",children:e.jsx("i",{className:"ri-more-2-fill text-lg"})}),b===t.id&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>n(null)}),e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-20",children:[e.jsxs("button",{onClick:()=>T(t),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2 cursor-pointer",children:[e.jsx("i",{className:"ri-edit-line"}),"Edit Role"]}),e.jsxs("button",{onClick:()=>L(t.id,t.is_active),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2 cursor-pointer",children:[e.jsx("i",{className:t.is_active?"ri-forbid-line":"ri-check-line"}),t.is_active?"Suspend User":"Activate User"]}),e.jsxs("button",{onClick:()=>F(t.id),className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center gap-2 cursor-pointer",children:[e.jsx("i",{className:"ri-delete-bin-line"}),"Delete User"]})]})]})]})]},t.id))})]})}),g.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"ri-user-search-line text-5xl text-gray-300"}),e.jsx("p",{className:"mt-4 text-gray-500",children:"No users found"})]})]})]}),R&&c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Edit User Role"}),e.jsx("button",{onClick:()=>o(!1),className:"text-gray-400 hover:text-gray-600 cursor-pointer",children:e.jsx("i",{className:"ri-close-line text-2xl"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Change role for ",e.jsx("span",{className:"font-medium text-gray-900",children:c.full_name})]}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Role"}),e.jsxs("select",{value:u,onChange:t=>w(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent cursor-pointer",children:[e.jsx("option",{value:"buyer",children:"Buyer"}),e.jsx("option",{value:"seller",children:"Seller"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"news_publisher",children:"News Publisher"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>o(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors whitespace-nowrap cursor-pointer",children:"Cancel"}),e.jsx("button",{onClick:M,disabled:v||u===c.role,className:"flex-1 px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors whitespace-nowrap cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:v?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-loader-4-line animate-spin"}),"Saving..."]}):"Save Changes"})]})]})}),A&&e.jsxs("div",{className:"fixed bottom-6 right-6 bg-green-600 text-white px-6 py-4 rounded-lg shadow-lg flex items-center gap-3 z-50 animate-slide-up",children:[e.jsx("div",{className:"w-8 h-8 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"ri-check-line text-xl"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Success!"}),e.jsx("p",{className:"text-sm text-green-100",children:"User role updated successfully"})]})]})]})}export{H as default};
//# sourceMappingURL=UserManagement-JEXcpBwg.js.map
