import{j as e}from"./query-vendor-C4XoQ8tj.js";import{u as E,r}from"./react-vendor-BpnWQj_L.js";import{u as q,N as h,s as f}from"./index-BvprY0-k.js";import{u as H}from"./useProducts-Bypg_9bL.js";import{g as z}from"./imageOptimization-D09L3Qvw.js";import"./i18n-vendor-BT3zpxCT.js";import"./supabase-vendor-NSJvwn9b.js";function O(){const g=E(),{user:a}=q(),{data:i,isLoading:y,error:j}=H(),[d,v]=r.useState("all"),[x,w]=r.useState(""),[n,N]=r.useState("all"),[c,C]=r.useState("newest"),[m,p]=r.useState([]),[k,b]=r.useState(!1),[_,S]=r.useState({}),P=async()=>{if(a)try{const{data:t,error:s}=await f.from("favorites").select("product_id").eq("user_id",a.id);if(s)throw s;p(t?.map(l=>l.product_id)||[])}catch(t){console.error("Error loading favorites:",t)}};r.useEffect(()=>{a&&P()},[a]),r.useEffect(()=>{if(i&&i.length>0){const t={};i.forEach(s=>{s.seller&&(t[s.seller_id]=s.seller)}),S(t)}},[i]);const F=[{id:"all",name:"All Products",icon:"ri-apps-line"},{id:"electronics",name:"Electronics",icon:"ri-smartphone-line"},{id:"books",name:"Books",icon:"ri-book-line"},{id:"fashion",name:"Fashion",icon:"ri-shirt-line"},{id:"food",name:"Food",icon:"ri-restaurant-line"},{id:"services",name:"Services",icon:"ri-service-line"},{id:"other",name:"Other",icon:"ri-more-line"}],u=r.useMemo(()=>(i||[]).filter(t=>{const s=d==="all"||t.category===d,l=t.name.toLowerCase().includes(x.toLowerCase())||t.description.toLowerCase().includes(x.toLowerCase());let o=!0;return t.price_type==="fixed"&&t.price&&(n==="under50"?o=t.price<50:n==="50-200"?o=t.price>=50&&t.price<=200:n==="over200"&&(o=t.price>200)),s&&l&&o}).sort((t,s)=>c==="price-low"&&t.price&&s.price?t.price-s.price:c==="price-high"&&t.price&&s.price?s.price-t.price:c==="newest"?new Date(s.created_at).getTime()-new Date(t.created_at).getTime():0),[i,d,x,n,c]);if(y)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(h,{}),e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading products..."})]})})]});if(j)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(h,{}),e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("i",{className:"ri-error-warning-line text-3xl text-red-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Failed to load products"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Please check your connection and try again"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors cursor-pointer whitespace-nowrap",children:"Retry"})]})})]});const L=async t=>{if(!a){g("/login");return}b(!0);try{if(m.includes(t)){const{error:l}=await f.from("favorites").delete().eq("user_id",a.id).eq("product_id",t);if(l)throw l;p(m.filter(o=>o!==t))}else{const{error:l}=await f.from("favorites").insert({user_id:a.id,product_id:t});if(l)throw l;p([...m,t])}}catch(s){console.error("Error toggling favorite:",s)}finally{b(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 via-white to-sky-50",children:[e.jsx(h,{}),e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white py-12 md:py-16 lg:py-20 xl:py-24",children:e.jsxs("div",{className:"max-w-7xl 2xl:max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8 xl:px-12",children:[e.jsx("h1",{className:"text-3xl md:text-4xl lg:text-5xl xl:text-6xl font-bold mb-4",children:"Campus Marketplace"}),e.jsx("p",{className:"text-blue-100 text-base md:text-lg lg:text-xl xl:text-2xl",children:"Discover amazing products from fellow students"})]})}),e.jsxs("div",{className:"max-w-7xl 2xl:max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8 xl:px-12 py-8 md:py-12 lg:py-16",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-4 md:p-6 lg:p-8 xl:p-10 mb-8",children:[e.jsx("div",{className:"mb-6 lg:mb-8",children:e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:"ri-search-line absolute left-4 lg:left-5 top-1/2 -translate-y-1/2 text-gray-400 text-lg lg:text-xl"}),e.jsx("input",{type:"text",placeholder:"Search products...",value:x,onChange:t=>w(t.target.value),className:"w-full pl-12 lg:pl-14 pr-4 py-3 lg:py-4 xl:py-5 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm md:text-base lg:text-lg"})]})}),e.jsxs("div",{className:"mb-6 lg:mb-8",children:[e.jsx("h3",{className:"text-sm lg:text-base xl:text-lg font-semibold text-gray-700 mb-3 lg:mb-4",children:"Categories"}),e.jsx("div",{className:"flex flex-wrap gap-2 lg:gap-3",children:F.map(t=>e.jsxs("button",{onClick:()=>v(t.id),className:`flex items-center gap-2 px-3 md:px-4 lg:px-5 xl:px-6 py-2 lg:py-2.5 xl:py-3 rounded-lg text-xs md:text-sm lg:text-base font-medium transition-all whitespace-nowrap cursor-pointer ${d===t.id?"bg-blue-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx("i",{className:`${t.icon} text-sm md:text-base lg:text-lg`}),e.jsx("span",{className:"hidden sm:inline",children:t.name})]},t.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 lg:gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm lg:text-base font-medium text-gray-700 mb-2 lg:mb-3",children:"Price Range"}),e.jsxs("select",{value:n,onChange:t=>N(t.target.value),className:"w-full px-4 lg:px-5 py-2 lg:py-3 xl:py-4 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm lg:text-base",children:[e.jsx("option",{value:"all",children:"All Prices"}),e.jsx("option",{value:"under50",children:"Under GH₵ 50"}),e.jsx("option",{value:"50-200",children:"GH₵ 50 - GH₵ 200"}),e.jsx("option",{value:"over200",children:"Over GH₵ 200"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm lg:text-base font-medium text-gray-700 mb-2 lg:mb-3",children:"Sort By"}),e.jsxs("select",{value:c,onChange:t=>C(t.target.value),className:"w-full px-4 lg:px-5 py-2 lg:py-3 xl:py-4 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm lg:text-base",children:[e.jsx("option",{value:"newest",children:"Newest First"}),e.jsx("option",{value:"price-low",children:"Price: Low to High"}),e.jsx("option",{value:"price-high",children:"Price: High to Low"})]})]})]})]}),e.jsx("div",{className:"mb-6 lg:mb-8",children:e.jsxs("p",{className:"text-gray-600 text-sm md:text-base lg:text-lg",children:["Showing ",e.jsx("span",{className:"font-semibold text-blue-600",children:u.length})," products"]})}),u.length===0?e.jsxs("div",{className:"text-center py-16 lg:py-24",children:[e.jsx("div",{className:"w-20 h-20 lg:w-24 lg:h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("i",{className:"ri-shopping-bag-line text-4xl lg:text-5xl text-gray-400"})}),e.jsx("h3",{className:"text-xl lg:text-2xl font-semibold text-gray-800 mb-2",children:"No products found"}),e.jsx("p",{className:"text-gray-600 lg:text-lg",children:"Try adjusting your filters or search query"})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4 md:gap-6 lg:gap-8",children:u.map(t=>{const s=_[t.seller_id];return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm hover:shadow-lg transition-all duration-300 overflow-hidden group cursor-pointer",onClick:()=>g(`/product/${t.id}`),children:[e.jsxs("div",{className:"relative h-48 md:h-56 lg:h-64 xl:h-72 overflow-hidden bg-gray-100",children:[e.jsx("img",{src:z(t.images?.[0],400,80)||"https://readdy.ai/api/search-image?query=product%20placeholder%20simple%20background&width=400&height=400&seq=marketplace-placeholder&orientation=squarish",alt:t.name,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-300",loading:"lazy",decoding:"async"}),e.jsx("button",{onClick:l=>{l.stopPropagation(),L(t.id)},disabled:k,className:"absolute top-3 right-3 w-9 h-9 lg:w-10 lg:h-10 bg-white rounded-full shadow-md flex items-center justify-center hover:bg-blue-50 transition-colors z-10 cursor-pointer",children:e.jsx("i",{className:`${m.includes(t.id)?"ri-heart-fill text-red-500":"ri-heart-line text-gray-600"} text-lg lg:text-xl`})}),e.jsx("div",{className:"absolute top-3 left-3 bg-white/90 backdrop-blur-sm px-3 py-1 lg:px-4 lg:py-1.5 rounded-full",children:e.jsx("span",{className:"text-xs lg:text-sm font-medium text-gray-700 capitalize",children:t.category})}),s&&e.jsxs("div",{className:"absolute bottom-3 left-3 flex items-center space-x-2 bg-white/95 backdrop-blur-sm px-3 py-1.5 lg:px-4 lg:py-2 rounded-full",children:[s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:s.full_name,className:"w-5 h-5 lg:w-6 lg:h-6 rounded-full object-cover border border-blue-500",loading:"lazy"}):e.jsx("div",{className:"w-5 h-5 lg:w-6 lg:h-6 bg-gradient-to-br from-blue-500 to-yellow-400 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-xs",children:s.full_name?.charAt(0).toUpperCase()})}),e.jsx("span",{className:"text-xs lg:text-sm font-medium text-gray-700",children:s.full_name})]})]}),e.jsxs("div",{className:"p-4 lg:p-5 xl:p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-2 line-clamp-2 text-sm md:text-base lg:text-lg group-hover:text-blue-600 transition-colors",children:t.name}),e.jsx("p",{className:"text-gray-600 text-xs md:text-sm lg:text-base mb-3 line-clamp-2",children:t.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[t.price_type==="fixed"&&t.price?e.jsxs("span",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-blue-600",children:["GH₵ ",t.price.toFixed(2)]}):e.jsx("span",{className:"text-sm md:text-base lg:text-lg font-semibold text-blue-600",children:"Contact for Price"}),e.jsx("button",{onClick:l=>{l.stopPropagation(),g(`/product/${t.id}`)},className:"px-4 py-2 lg:px-5 lg:py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm lg:text-base font-medium whitespace-nowrap cursor-pointer",children:"View Details"})]})]})]},t.id)})})]})]})}export{O as default};
//# sourceMappingURL=Marketplace-DsduME5L.js.map
