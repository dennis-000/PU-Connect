import{j as e}from"./query-vendor-C4XoQ8tj.js";import{u as M,r}from"./react-vendor-BpnWQj_L.js";import{u as D,s as a,N as $}from"./index-BvprY0-k.js";import"./i18n-vendor-BT3zpxCT.js";import"./supabase-vendor-NSJvwn9b.js";function B(){const N=M(),{profile:p,loading:u}=D(),[g,P]=r.useState([]),[E,_]=r.useState(!0),[l,S]=r.useState(""),[i,v]=r.useState("publishers"),[U,n]=r.useState(!1),[L,d]=r.useState(!1),[f,c]=r.useState(""),[b,m]=r.useState("");r.useEffect(()=>{!u&&p?.role!=="admin"&&N("/")},[p,u,N]),r.useEffect(()=>{x()},[]);const x=async()=>{try{const{data:s,error:t}=await a.from("profiles").select("id, email, full_name, role, created_at").order("created_at",{ascending:!1});if(t)throw t;P(s||[])}catch(s){console.error("Error fetching users:",s)}finally{_(!1)}},R=async()=>{if(!f.trim()){alert("Please enter an email address");return}try{const{data:s,error:t}=await a.from("profiles").select("*").eq("email",f.trim()).single();if(t||!s){alert("User not found with this email address");return}if(s.role==="news_publisher"){alert("This user is already a News Publisher");return}const{error:o}=await a.from("profiles").update({role:"news_publisher"}).eq("id",s.id);if(o)throw o;await x(),n(!1),c(""),alert("News Publisher role assigned successfully!")}catch(s){console.error("Error adding news publisher:",s),alert("Failed to assign News Publisher role")}},T=async()=>{if(!b.trim()){alert("Please enter an email address");return}try{const{data:s,error:t}=await a.from("profiles").select("*").eq("email",b.trim()).single();if(t||!s){alert("User not found with this email address");return}if(s.role==="admin"){alert("This user is already an Administrator");return}if(!confirm(`Are you sure you want to grant Administrator privileges to ${s.full_name}? This will give them full access to the admin dashboard.`))return;const{error:j}=await a.from("profiles").update({role:"admin"}).eq("id",s.id);if(j)throw j;await x(),d(!1),m(""),alert("Administrator role assigned successfully!")}catch(s){console.error("Error adding admin:",s),alert("Failed to assign Administrator role")}},k=async(s,t,o)=>{if(confirm(`Remove ${o==="admin"?"Administrator":"News Publisher"} role from ${t}? They will become a regular buyer.`))try{const{error:h}=await a.from("profiles").update({role:"buyer"}).eq("id",s);if(h)throw h;await x(),alert("Role removed successfully")}catch(h){console.error("Error removing role:",h),alert("Failed to remove role")}},y=g.filter(s=>s.role==="news_publisher"),w=g.filter(s=>s.role==="admin"),A=y.filter(s=>s.email.toLowerCase().includes(l.toLowerCase())||s.full_name.toLowerCase().includes(l.toLowerCase())),C=w.filter(s=>s.email.toLowerCase().includes(l.toLowerCase())||s.full_name.toLowerCase().includes(l.toLowerCase()));return u||E?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-loader-4-line text-4xl text-sky-600 animate-spin"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx($,{}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Role Management"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Manage administrators and special permissions"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>n(!0),className:"flex items-center gap-2 px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700 transition-colors whitespace-nowrap cursor-pointer",children:[e.jsx("i",{className:"ri-newspaper-line"}),"Add Publisher"]}),e.jsxs("button",{onClick:()=>d(!0),className:"flex items-center gap-2 px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition-colors whitespace-nowrap cursor-pointer",children:[e.jsx("i",{className:"ri-shield-user-line"}),"Add Admin"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6 border-2 border-amber-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Administrators"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:w.length})]}),e.jsx("div",{className:"w-12 h-12 bg-amber-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-shield-user-line text-2xl text-amber-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6 border-2 border-sky-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"News Publishers"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:y.length})]}),e.jsx("div",{className:"w-12 h-12 bg-sky-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-newspaper-line text-2xl text-sky-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:g.length})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-user-line text-2xl text-green-600"})})]})})]}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-2 mb-6",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>v("admins"),className:`flex-1 px-4 py-2 text-sm font-medium rounded-lg whitespace-nowrap cursor-pointer transition-colors ${i==="admins"?"bg-amber-500 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx("i",{className:"ri-shield-user-line mr-2"}),"Administrators (",w.length,")"]}),e.jsxs("button",{onClick:()=>v("publishers"),className:`flex-1 px-4 py-2 text-sm font-medium rounded-lg whitespace-nowrap cursor-pointer transition-colors ${i==="publishers"?"bg-sky-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx("i",{className:"ri-newspaper-line mr-2"}),"News Publishers (",y.length,")"]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:"ri-search-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:l,onChange:s=>S(s.target.value),placeholder:`Search ${i==="admins"?"administrators":"news publishers"}...`,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent text-sm"})]})}),i==="admins"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-amber-50 to-white",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Administrators"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Users with full platform management access"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Added On"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:C.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-400 to-amber-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-medium text-sm",children:s.full_name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.full_name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:"px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-amber-100 text-amber-800",children:[e.jsx("i",{className:"ri-shield-user-line mr-1"}),"Administrator"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:s.id!==p?.id?e.jsx("button",{onClick:()=>k(s.id,s.full_name,s.role),className:"text-red-600 hover:text-red-800 font-medium cursor-pointer",children:"Remove Role"}):e.jsx("span",{className:"text-gray-400 text-xs",children:"Current User"})})]},s.id))})]})}),C.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"ri-shield-user-line text-5xl text-gray-300"}),e.jsx("p",{className:"mt-4 text-gray-500",children:"No administrators found"}),e.jsx("button",{onClick:()=>d(!0),className:"mt-4 text-amber-600 hover:text-amber-700 font-medium cursor-pointer",children:"Add your first administrator"})]})]}),i==="publishers"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-sky-50 to-white",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"News Publishers"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Users with permission to publish campus news"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Added On"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:A.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-sky-500 to-sky-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-medium text-sm",children:s.full_name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.full_name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:"px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-sky-100 text-sky-800",children:[e.jsx("i",{className:"ri-newspaper-line mr-1"}),"News Publisher"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("button",{onClick:()=>k(s.id,s.full_name,s.role),className:"text-red-600 hover:text-red-800 font-medium cursor-pointer",children:"Remove Role"})})]},s.id))})]})}),A.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"ri-newspaper-line text-5xl text-gray-300"}),e.jsx("p",{className:"mt-4 text-gray-500",children:"No news publishers found"}),e.jsx("button",{onClick:()=>n(!0),className:"mt-4 text-sky-600 hover:text-sky-700 font-medium cursor-pointer",children:"Add your first news publisher"})]})]})]}),U&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Add News Publisher"}),e.jsx("button",{onClick:()=>{n(!1),c("")},className:"text-gray-400 hover:text-gray-600 cursor-pointer",children:e.jsx("i",{className:"ri-close-line text-2xl"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Enter the email address of the user you want to assign the News Publisher role to."}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"User Email"}),e.jsx("input",{type:"email",value:f,onChange:s=>c(s.target.value),placeholder:"user@example.com",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent text-sm"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{n(!1),c("")},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors whitespace-nowrap cursor-pointer",children:"Cancel"}),e.jsx("button",{onClick:R,className:"flex-1 px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700 transition-colors whitespace-nowrap cursor-pointer",children:"Add Publisher"})]})]})}),L&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Add Administrator"}),e.jsx("button",{onClick:()=>{d(!1),m("")},className:"text-gray-400 hover:text-gray-600 cursor-pointer",children:e.jsx("i",{className:"ri-close-line text-2xl"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("i",{className:"ri-alert-line text-amber-600 text-xl flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-amber-900 mb-1",children:"Important"}),e.jsx("p",{className:"text-xs text-amber-800",children:"Administrators have full access to manage users, products, news, subscriptions, and all platform settings. Only grant this role to trusted users."})]})]})}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"User Email"}),e.jsx("input",{type:"email",value:b,onChange:s=>m(s.target.value),placeholder:"user@example.com",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent text-sm"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{d(!1),m("")},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors whitespace-nowrap cursor-pointer",children:"Cancel"}),e.jsx("button",{onClick:T,className:"flex-1 px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition-colors whitespace-nowrap cursor-pointer",children:"Add Admin"})]})]})})]})}export{B as default};
//# sourceMappingURL=RoleManagement-B8LWz-H5.js.map
