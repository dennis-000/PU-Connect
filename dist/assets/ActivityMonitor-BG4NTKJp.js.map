{"version":3,"file":"ActivityMonitor-BG4NTKJp.js","sources":["../../src/pages/admin/ActivityMonitor.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { useNavigate, useSearchParams } from 'react-router-dom';\r\nimport { useAuth } from '../../contexts/AuthContext';\r\nimport { supabase } from '../../lib/supabase';\r\nimport Navbar from '../../components/feature/Navbar';\r\n\r\ninterface ActivityLog {\r\n  id: string;\r\n  user_id: string;\r\n  action_type: string;\r\n  action_details: any;\r\n  created_at: string;\r\n  user?: {\r\n    full_name: string;\r\n    email: string;\r\n  };\r\n}\r\n\r\nexport default function ActivityMonitor() {\r\n  const { profile } = useAuth();\r\n  const navigate = useNavigate();\r\n  const [searchParams] = useSearchParams();\r\n  const [activities, setActivities] = useState<ActivityLog[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [filterType, setFilterType] = useState(searchParams.get('filter') || 'all');\r\n\r\n  useEffect(() => {\r\n    if (profile?.role !== 'admin' && profile?.role !== 'super_admin') {\r\n      navigate('/marketplace');\r\n      return;\r\n    }\r\n    fetchActivities();\r\n\r\n    // Realtime subscription\r\n    const channel = supabase\r\n      .channel('public:activity_logs')\r\n      .on(\r\n        'postgres_changes',\r\n        { event: 'INSERT', schema: 'public', table: 'activity_logs' },\r\n        (payload) => {\r\n          console.log('New activity:', payload);\r\n          fetchActivities();\r\n        }\r\n      )\r\n      .subscribe();\r\n\r\n    return () => {\r\n      supabase.removeChannel(channel);\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [profile]);\r\n\r\n  // Update filter if URL changes\r\n  useEffect(() => {\r\n    const filter = searchParams.get('filter');\r\n    if (filter) setFilterType(filter);\r\n  }, [searchParams]);\r\n\r\n  const fetchActivities = async () => {\r\n    setLoading(true);\r\n    const { data, error } = await supabase\r\n      .from('activity_logs')\r\n      .select(`\r\n        *,\r\n        user:profiles!user_id(full_name, email)\r\n      `)\r\n      .order('created_at', { ascending: false })\r\n      .limit(100);\r\n\r\n    if (!error && data) {\r\n      setActivities(data as any);\r\n    }\r\n    setLoading(false);\r\n  };\r\n\r\n  const filteredActivities = filterType === 'all'\r\n    ? activities\r\n    : activities.filter(a => a.action_type === filterType);\r\n\r\n  const getActionIcon = (actionType: string) => {\r\n    switch (actionType) {\r\n      case 'login': return 'ri-login-box-line';\r\n      case 'logout': return 'ri-logout-box-line';\r\n      case 'product_created': return 'ri-add-box-line';\r\n      case 'product_updated': return 'ri-edit-box-line';\r\n      case 'product_deleted': return 'ri-delete-bin-line';\r\n      case 'message_sent': return 'ri-message-line';\r\n      case 'sms_sent': return 'ri-message-2-line';\r\n      case 'application_submitted': return 'ri-file-list-line';\r\n      case 'application_approved': return 'ri-checkbox-circle-line';\r\n      case 'application_rejected': return 'ri-close-circle-line';\r\n      case 'news_created': return 'ri-article-line';\r\n      case 'news_updated': return 'ri-edit-2-line';\r\n      case 'news_published': return 'ri-send-plane-fill';\r\n      case 'news_deleted': return 'ri-delete-bin-2-line';\r\n      default: return 'ri-information-line';\r\n    }\r\n  };\r\n\r\n  const getActionColor = (actionType: string) => {\r\n    switch (actionType) {\r\n      case 'login': return 'bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400';\r\n      case 'logout': return 'bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-400';\r\n      case 'product_created': return 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400';\r\n      case 'product_updated': return 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400';\r\n      case 'product_deleted': return 'bg-rose-100 text-rose-700 dark:bg-rose-900/30 dark:text-rose-400';\r\n      case 'message_sent': return 'bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400';\r\n      case 'sms_sent': return 'bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-400';\r\n      case 'application_submitted': return 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400';\r\n      case 'application_approved': return 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400';\r\n      case 'application_rejected': return 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400';\r\n      case 'news_created': return 'bg-cyan-100 text-cyan-700 dark:bg-cyan-900/30 dark:text-cyan-400';\r\n      case 'news_updated': return 'bg-teal-100 text-teal-700 dark:bg-teal-900/30 dark:text-teal-400';\r\n      case 'news_published': return 'bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-400';\r\n      case 'news_deleted': return 'bg-pink-100 text-pink-700 dark:bg-pink-900/30 dark:text-pink-400';\r\n      default: return 'bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-400';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-slate-50 dark:bg-slate-900 transition-colors duration-300 pb-20 font-sans\">\r\n      <Navbar />\r\n\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-28 pb-12 box-border\">\r\n        <div className=\"mb-8 flex flex-col md:flex-row md:items-end justify-between gap-6\">\r\n          <div>\r\n            <div className=\"flex items-center gap-2 mb-2\">\r\n              <span className=\"px-3 py-1 rounded-full bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 text-[10px] font-bold uppercase tracking-widest border border-amber-200 dark:border-amber-800\">\r\n                Security & Logs\r\n              </span>\r\n            </div>\r\n            <h1 className=\"text-3xl md:text-5xl font-black text-slate-900 dark:text-white tracking-tight mb-2\">Audit Trails</h1>\r\n            <p className=\"text-slate-500 dark:text-slate-400 font-medium\">Real-time monitoring of platform events and security actions.</p>\r\n          </div>\r\n          <button\r\n            onClick={() => navigate('/admin/dashboard')}\r\n            className=\"px-6 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl text-xs font-bold uppercase tracking-wide shadow-sm hover:shadow-md transition-all cursor-pointer flex items-center gap-2\"\r\n          >\r\n            <i className=\"ri-arrow-left-line text-lg\"></i> Dashboard\r\n          </button>\r\n        </div>\r\n\r\n        {/* Filter */}\r\n        <div className=\"bg-white dark:bg-slate-800 rounded-2xl border border-slate-100 dark:border-slate-700 p-2 mb-8 shadow-sm overflow-x-auto\">\r\n          <div className=\"flex items-center space-x-2\">\r\n            {[\r\n              { id: 'all', label: 'All History' },\r\n              { id: 'login', label: 'Login History' },\r\n              { id: 'application_submitted', label: 'New Applications' },\r\n              { id: 'application_approved', label: 'Approved Applications' },\r\n              { id: 'application_rejected', label: 'Rejected Applications' },\r\n              { id: 'product_created', label: 'Product History' },\r\n              { id: 'sms_sent', label: 'SMS History' },\r\n              { id: 'message_sent', label: 'Message History' },\r\n              { id: 'news_created', label: 'News Created' },\r\n              { id: 'news_updated', label: 'News Updated' },\r\n              { id: 'news_published', label: 'News Published' }\r\n            ].map(filter => (\r\n              <button\r\n                key={filter.id}\r\n                onClick={() => {\r\n                  setFilterType(filter.id);\r\n                  navigate(`?filter=${filter.id}`, { replace: true });\r\n                }}\r\n                className={`px-4 py-2 text-xs font-bold uppercase tracking-wide rounded-xl transition-all whitespace-nowrap cursor-pointer ${filterType === filter.id\r\n                  ? 'bg-slate-900 dark:bg-white text-white dark:text-slate-900 shadow-md'\r\n                  : 'text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-700'\r\n                  }`}\r\n              >\r\n                {filter.label}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Activity Timeline */}\r\n        <div className=\"bg-white dark:bg-slate-800 rounded-[2rem] border border-slate-100 dark:border-slate-700 shadow-sm p-6 md:p-8\">\r\n          {loading ? (\r\n            <div className=\"text-center py-20\">\r\n              <div className=\"inline-block w-10 h-10 border-4 border-slate-200 border-t-slate-800 rounded-full animate-spin\"></div>\r\n              <p className=\"mt-4 text-xs font-bold uppercase tracking-widest text-slate-400\">Loading logs...</p>\r\n            </div>\r\n          ) : filteredActivities.length === 0 ? (\r\n            <div className=\"text-center py-20\">\r\n              <div className=\"w-20 h-20 bg-slate-50 dark:bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-6\">\r\n                <i className=\"ri-history-line text-4xl text-slate-300 dark:text-slate-500\"></i>\r\n              </div>\r\n              <h3 className=\"text-xl font-bold text-slate-900 dark:text-white mb-2\">No activities found</h3>\r\n              <p className=\"text-slate-500 max-w-sm mx-auto\">Activities will appear here as users interact with the platform.</p>\r\n            </div>\r\n          ) : (\r\n            <div className=\"space-y-4\">\r\n              {filteredActivities.map((activity) => (\r\n                <div\r\n                  key={activity.id}\r\n                  className=\"flex items-start space-x-4 p-4 rounded-2xl hover:bg-slate-50 dark:hover:bg-slate-700/30 transition-all border border-transparent hover:border-slate-100 dark:hover:border-slate-700 group\"\r\n                >\r\n                  <div className={`w-12 h-12 rounded-2xl flex items-center justify-center flex-shrink-0 ${getActionColor(activity.action_type)} group-hover:scale-110 transition-transform`}>\r\n                    <i className={`${getActionIcon(activity.action_type)} text-xl`}></i>\r\n                  </div>\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <div className=\"flex items-center justify-between mb-1\">\r\n                      <h3 className=\"text-sm font-bold text-slate-900 dark:text-white\">\r\n                        {activity.user?.full_name || 'System / Unknown'}\r\n                      </h3>\r\n                      <span className=\"text-[10px] font-medium text-slate-400 uppercase tracking-wide\">\r\n                        {new Date(activity.created_at).toLocaleString()}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2 mb-1\">\r\n                      <span className={`px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide ${getActionColor(activity.action_type)} bg-opacity-20`}>\r\n                        {activity.action_type.split('_').join(' ')}\r\n                      </span>\r\n                    </div>\r\n                    {activity.action_details && (\r\n                      <div className=\"text-xs text-slate-500 dark:text-slate-400 font-mono bg-slate-50 dark:bg-slate-900/50 p-3 rounded-xl mt-2 overflow-x-auto border border-slate-100 dark:border-slate-800\">\r\n                        {typeof activity.action_details === 'string' ? activity.action_details : JSON.stringify(activity.action_details, null, 2)}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["ActivityMonitor","profile","useAuth","navigate","useNavigate","searchParams","useSearchParams","activities","setActivities","useState","loading","setLoading","filterType","setFilterType","useEffect","fetchActivities","channel","supabase","payload","filter","data","error","filteredActivities","a","getActionIcon","actionType","getActionColor","jsxs","jsx","Navbar","activity"],"mappings":"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"}