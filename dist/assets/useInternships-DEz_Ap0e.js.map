{"version":3,"mappings":"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","names":["useInternships","filters","useQuery","results","dbQuery","supabase","searchTerm","data","error","err","fetchLinkedInJobs","__vitePreload","queries","uniqueQueries","linkedInPromises","q","mappedLinkedInJobs","job","id","title","company","location","type","url","logo_url","posted_at","allJobs","item","a","b"],"ignoreList":[],"sources":["../../src/hooks/useInternships.ts"],"sourcesContent":["import { useQuery } from '@tanstack/react-query';\r\nimport { supabase } from '../lib/supabase';\r\n\r\nexport type Internship = {\r\n    id: string;\r\n    title: string;\r\n    company: string;\r\n    location: string;\r\n    type: string;\r\n    source: string;\r\n    description: string;\r\n    url: string;\r\n    logo_url?: string;\r\n    posted_at: string;\r\n    created_at: string;\r\n    is_active: boolean;\r\n};\r\n\r\n// Fallback Mock Data (matches the database schema)\r\nconst MOCK_DATA: Internship[] = [\r\n    {\r\n        id: '1',\r\n        title: 'Software Engineering Intern',\r\n        company: 'Tech Co Ghana',\r\n        location: 'Accra, Ghana',\r\n        type: 'Full-time',\r\n        source: 'LinkedIn',\r\n        description: 'Join our dynamic team to build the future of fintech in Africa.',\r\n        posted_at: new Date(Date.now() - 1000 * 60 * 60 * 48).toISOString(), // 2 days ago\r\n        logo_url: 'https://ui-avatars.com/api/?name=Tech+Co&background=0D8ABC&color=fff',\r\n        url: '#',\r\n        created_at: new Date().toISOString(),\r\n        is_active: true\r\n    },\r\n    {\r\n        id: '2',\r\n        title: 'Data Science Intern',\r\n        company: 'Global Corp',\r\n        location: 'Remote (USA)',\r\n        type: 'Part-time',\r\n        source: 'LinkedIn',\r\n        description: 'Analyze large datasets and build predictive models.',\r\n        posted_at: new Date(Date.now() - 1000 * 60 * 60 * 24 * 5).toISOString(), // 5 days ago\r\n        logo_url: 'https://ui-avatars.com/api/?name=Global+Corp&background=6366f1&color=fff',\r\n        url: '#',\r\n        created_at: new Date().toISOString(),\r\n        is_active: true\r\n    },\r\n    {\r\n        id: '3',\r\n        title: 'Marketing Specialist Intern',\r\n        company: 'Sowutoum Media',\r\n        location: 'Sowutoum, Ghana',\r\n        type: 'On-site',\r\n        source: 'Direct',\r\n        description: 'Assist in managing social media campaigns for local businesses.',\r\n        posted_at: new Date(Date.now() - 1000 * 60 * 60 * 24 * 7).toISOString(),\r\n        logo_url: 'https://ui-avatars.com/api/?name=Sowutoum+Media&background=f43f5e&color=fff',\r\n        url: '#',\r\n        created_at: new Date().toISOString(),\r\n        is_active: true\r\n    },\r\n    {\r\n        id: '4',\r\n        title: 'Graphic Design Intern',\r\n        company: 'Creative Studio',\r\n        location: 'London, UK (Remote)',\r\n        type: 'Internship',\r\n        source: 'Abroad',\r\n        description: 'Create stunning visuals for international clients.',\r\n        posted_at: new Date(Date.now() - 1000 * 60 * 60 * 24 * 3).toISOString(),\r\n        logo_url: 'https://ui-avatars.com/api/?name=Creative+Studio&background=10b981&color=fff',\r\n        url: '#',\r\n        created_at: new Date().toISOString(),\r\n        is_active: true\r\n    }\r\n];\r\n\r\nexport function useInternships(filters?: { search?: string; type?: string }) {\r\n    return useQuery({\r\n        queryKey: ['internships', filters],\r\n        queryFn: async () => {\r\n            const results: Internship[] = [];\r\n\r\n            // 1. Fetch from Supabase\r\n            try {\r\n                let dbQuery = supabase\r\n                    .from('internships')\r\n                    .select('*')\r\n                    .eq('is_active', true);\r\n\r\n                // Apply search filter if present\r\n                if (filters?.search) {\r\n                    const searchTerm = filters.search.trim();\r\n                    // Using .or() to search across title and company\r\n                    dbQuery = dbQuery.or(`title.ilike.%${searchTerm}%,company.ilike.%${searchTerm}%,description.ilike.%${searchTerm}%`);\r\n                }\r\n\r\n                const { data, error } = await dbQuery.order('posted_at', { ascending: false });\r\n\r\n                if (error) {\r\n                    console.warn('Fetching Supabase internships failed:', error);\r\n                } else if (data && data.length > 0) {\r\n                    results.push(...data);\r\n                }\r\n            } catch (err) {\r\n                console.error('Supabase error:', err);\r\n            }\r\n\r\n            // 2. Fetch from LinkedIn (Multi-Query Strategy to Maximize Results)\r\n            const { fetchLinkedInJobs } = await import('../lib/linkedin-service');\r\n\r\n            const baseSearch = filters?.search ? `${filters.search} Internship` : 'Internship';\r\n\r\n            // We'll run multiple queries to get a diverse set of results\r\n            const queries = [\r\n                baseSearch,\r\n                'Internship Ghana',\r\n                'Remote Internship',\r\n                'Software Engineering Internship',\r\n                'Marketing Internship'\r\n            ];\r\n\r\n            // Remove duplicates if baseSearch overlaps\r\n            const uniqueQueries = [...new Set(queries)];\r\n\r\n            console.log('Fetching LinkedIn jobs for queries:', uniqueQueries);\r\n\r\n            const linkedInPromises = uniqueQueries.map(q => fetchLinkedInJobs(q));\r\n            const linkedInResults = await Promise.all(linkedInPromises);\r\n\r\n            // Flatten results\r\n            const allLinkedInJobs = linkedInResults.flat();\r\n\r\n            const mappedLinkedInJobs: Internship[] = allLinkedInJobs.map(job => {\r\n                const id = job.job_id || job.id || Math.random().toString();\r\n                const title = job.job_title || job.title || 'Internship';\r\n                const company = job.employer_name || job.organization || 'Unknown Company';\r\n\r\n                let location = 'Remote';\r\n                if (job.locations_derived && job.locations_derived.length > 0) {\r\n                    location = job.locations_derived[0];\r\n                } else if (job.job_city || job.job_country) {\r\n                    location = `${job.job_city || ''}, ${job.job_country || ''}`.replace(/^, /, '').trim();\r\n                }\r\n\r\n                // Handle employment type (array or string)\r\n                let type = 'Internship';\r\n                if (Array.isArray(job.employment_type) && job.employment_type.length > 0) {\r\n                    type = job.employment_type[0]; // e.g. \"INTERN\"\r\n                } else if (job.job_employment_type) {\r\n                    type = job.job_employment_type;\r\n                }\r\n\r\n                const url = job.job_apply_link || job.url || '#';\r\n                const logo_url = job.employer_logo || job.organization_logo || `https://ui-avatars.com/api/?name=${encodeURIComponent(company)}&background=0077b5&color=fff`;\r\n                const posted_at = job.job_posted_at_datetime_utc || job.date_posted || new Date().toISOString();\r\n\r\n                return {\r\n                    id,\r\n                    title,\r\n                    company,\r\n                    location,\r\n                    type,\r\n                    source: 'LinkedIn',\r\n                    description: job.job_description || '',\r\n                    url,\r\n                    logo_url,\r\n                    posted_at,\r\n                    created_at: new Date().toISOString(),\r\n                    is_active: true\r\n                };\r\n            });\r\n\r\n            // Combine results\r\n            // Deduplicate by ID just in case\r\n            const allJobs = [...results, ...mappedLinkedInJobs];\r\n            const uniqueJobs = Array.from(new Map(allJobs.map(item => [item.id, item])).values());\r\n\r\n            // Sort by date (newest first)\r\n            return uniqueJobs.sort((a, b) =>\r\n                new Date(b.posted_at).getTime() - new Date(a.posted_at).getTime()\r\n            );\r\n        },\r\n        staleTime: 0, // Real-time: Always refetch on mount\r\n    });\r\n}\r\n"],"file":"useInternships-DEz_Ap0e.js"}