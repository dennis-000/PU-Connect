{"version":3,"file":"SupportTickets-D0eC5Tmc.js","sources":["../../src/pages/admin/SupportTickets.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { supabase } from '../../lib/supabase';\r\nimport { useAuth } from '../../contexts/AuthContext';\r\nimport Navbar from '../../components/feature/Navbar';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\ntype Ticket = {\r\n    id: string;\r\n    subject: string;\r\n    message: string;\r\n    status: 'open' | 'in_progress' | 'resolved' | 'closed';\r\n    priority: 'low' | 'medium' | 'high' | 'urgent';\r\n    created_at: string;\r\n    user_id: string;\r\n    user?: {\r\n        full_name: string;\r\n        email: string;\r\n        phone: string;\r\n    };\r\n};\r\n\r\nexport default function SupportTickets() {\r\n    const { profile } = useAuth();\r\n    const navigate = useNavigate();\r\n    const [tickets, setTickets] = useState<Ticket[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [filter, setFilter] = useState<'all' | 'open' | 'resolved'>('all');\r\n\r\n    useEffect(() => {\r\n        if (profile?.role !== 'admin' && profile?.role !== 'super_admin') {\r\n            navigate('/marketplace');\r\n            return;\r\n        }\r\n        fetchTickets();\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [filter]);\r\n\r\n    const fetchTickets = async () => {\r\n        setLoading(true);\r\n        try {\r\n            let query = supabase\r\n                .from('support_tickets')\r\n                .select('*, user:profiles!user_id(full_name, email, phone)')\r\n                .order('created_at', { ascending: false });\r\n\r\n            if (filter !== 'all') {\r\n                if (filter === 'open') {\r\n                    query = query.in('status', ['open', 'in_progress']);\r\n                } else {\r\n                    query = query.in('status', ['resolved', 'closed']);\r\n                }\r\n            }\r\n\r\n            const { data, error } = await query;\r\n            if (error) throw error;\r\n            setTickets(data as any || []);\r\n        } catch (error) {\r\n            console.error('Error fetching tickets:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const updateStatus = async (id: string, newStatus: string) => {\r\n        try {\r\n            const { error } = await supabase.from('support_tickets').update({ status: newStatus }).eq('id', id);\r\n            if (error) throw error;\r\n            fetchTickets();\r\n        } catch (err) {\r\n            console.error('Error updating ticket', err);\r\n        }\r\n    };\r\n\r\n    const deleteTicket = async (id: string) => {\r\n        if (!confirm('Permanently delete this ticket?')) return;\r\n        try {\r\n            const { error } = await supabase.from('support_tickets').delete().eq('id', id);\r\n            if (error) throw error;\r\n            fetchTickets();\r\n        } catch (err) {\r\n            console.error('Error deleting ticket', err);\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-slate-50 dark:bg-slate-900 transition-colors duration-300 pb-20 font-sans\">\r\n            <Navbar />\r\n\r\n            <div className=\"pt-32 md:pt-40 pb-12 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n                <div className=\"flex flex-col md:flex-row md:items-end justify-between gap-6 mb-10\">\r\n                    <div>\r\n                        <div className=\"flex items-center gap-2 mb-2\">\r\n                            <span className=\"px-3 py-1 rounded-full bg-pink-100 dark:bg-pink-900/30 text-pink-700 dark:text-pink-300 text-[10px] font-bold uppercase tracking-widest border border-pink-200 dark:border-pink-800\">\r\n                                Help Desk\r\n                            </span>\r\n                        </div>\r\n                        <h1 className=\"text-3xl md:text-5xl font-black text-slate-900 dark:text-white tracking-tight mb-2\">\r\n                            Support Tickets\r\n                        </h1>\r\n                        <p className=\"text-slate-500 dark:text-slate-400 font-medium\">Manage user inquiries and issues.</p>\r\n                    </div>\r\n\r\n                    <button\r\n                        onClick={() => navigate('/admin')}\r\n                        className=\"px-6 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-200 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors text-xs font-bold uppercase tracking-wide whitespace-nowrap cursor-pointer flex items-center gap-2\"\r\n                    >\r\n                        <i className=\"ri-arrow-left-line text-lg\"></i>\r\n                        Back to Dashboard\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Filters */}\r\n                <div className=\"flex gap-2 mb-6 overflow-x-auto pb-2\">\r\n                    {['all', 'open', 'resolved'].map(f => (\r\n                        <button\r\n                            key={f}\r\n                            onClick={() => setFilter(f as any)}\r\n                            className={`px-4 py-2 rounded-xl text-xs font-bold uppercase tracking-widest transition-all ${filter === f\r\n                                ? 'bg-slate-900 text-white dark:bg-white dark:text-slate-900'\r\n                                : 'bg-white text-slate-500 hover:bg-slate-100 dark:bg-slate-800 dark:text-slate-400'\r\n                                }`}\r\n                        >\r\n                            {f}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n\r\n                {loading ? (\r\n                    <div className=\"text-center py-20\">\r\n                        <i className=\"ri-loader-4-line text-4xl animate-spin text-blue-600\"></i>\r\n                    </div>\r\n                ) : tickets.length === 0 ? (\r\n                    <div className=\"text-center py-20 bg-white dark:bg-slate-800 rounded-[2rem]\">\r\n                        <div className=\"w-20 h-20 bg-slate-50 dark:bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-6\">\r\n                            <i className=\"ri-customer-service-2-line text-4xl text-slate-300\"></i>\r\n                        </div>\r\n                        <h3 className=\"text-lg font-bold text-slate-900 dark:text-white\">No tickets found</h3>\r\n                        <p className=\"text-slate-500 text-sm\">Great job! All caught up.</p>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"grid grid-cols-1 gap-4\">\r\n                        {tickets.map(ticket => (\r\n                            <div key={ticket.id} className=\"bg-white dark:bg-slate-800 p-6 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-sm hover:shadow-md transition-all\">\r\n                                <div className=\"flex flex-col md:flex-row justify-between gap-4\">\r\n                                    <div className=\"flex-1\">\r\n                                        <div className=\"flex items-center gap-3 mb-2\">\r\n                                            <span className={`px-2 py-1 rounded-lg text-[10px] font-bold uppercase tracking-widest ${ticket.priority === 'urgent' ? 'bg-red-100 text-red-700' :\r\n                                                ticket.priority === 'high' ? 'bg-orange-100 text-orange-700' :\r\n                                                    'bg-blue-100 text-blue-700'\r\n                                                }`}>\r\n                                                {ticket.priority}\r\n                                            </span>\r\n                                            <span className=\"text-xs text-slate-400 font-mono\">\r\n                                                #{ticket.id.slice(0, 8)}\r\n                                            </span>\r\n                                            <span className=\"text-xs text-slate-400\">\r\n                                                • {new Date(ticket.created_at).toLocaleDateString()}\r\n                                            </span>\r\n                                        </div>\r\n                                        <h3 className=\"text-lg font-bold text-slate-900 dark:text-white mb-2\">{ticket.subject}</h3>\r\n                                        <p className=\"text-slate-600 dark:text-slate-300 text-sm leading-relaxed mb-4 p-4 bg-slate-50 dark:bg-slate-900/50 rounded-xl\">\r\n                                            {ticket.message}\r\n                                        </p>\r\n\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <div className=\"w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-slate-500 font-bold text-xs\">\r\n                                                {ticket.user?.full_name?.charAt(0)}\r\n                                            </div>\r\n                                            <div className=\"text-xs\">\r\n                                                <p className=\"font-bold text-slate-900 dark:text-white\">{ticket.user?.full_name || 'Unknown User'}</p>\r\n                                                <p className=\"text-slate-500\">{ticket.user?.email} • {ticket.user?.phone}</p>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"flex flex-row md:flex-col gap-2 justify-center md:border-l md:border-slate-100 md:dark:border-slate-700 md:pl-6 min-w-[150px]\">\r\n                                        <p className=\"text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-1 hidden md:block\">Actions</p>\r\n                                        {ticket.status !== 'resolved' && (\r\n                                            <button\r\n                                                onClick={() => updateStatus(ticket.id, 'resolved')}\r\n                                                className=\"px-4 py-2 bg-emerald-50 text-emerald-600 rounded-xl text-xs font-bold uppercase tracking-wide hover:bg-emerald-100 transition-colors flex items-center justify-center gap-2\"\r\n                                            >\r\n                                                <i className=\"ri-check-line text-lg\"></i>\r\n                                                Resolve\r\n                                            </button>\r\n                                        )}\r\n                                        {ticket.status !== 'in_progress' && ticket.status !== 'resolved' && (\r\n                                            <button\r\n                                                onClick={() => updateStatus(ticket.id, 'in_progress')}\r\n                                                className=\"px-4 py-2 bg-blue-50 text-blue-600 rounded-xl text-xs font-bold uppercase tracking-wide hover:bg-blue-100 transition-colors flex items-center justify-center gap-2\"\r\n                                            >\r\n                                                <i className=\"ri-loader-2-line text-lg\"></i>\r\n                                                Process\r\n                                            </button>\r\n                                        )}\r\n                                        <button\r\n                                            onClick={() => deleteTicket(ticket.id)}\r\n                                            className=\"px-4 py-2 opacity-40 hover:opacity-100 text-rose-600 rounded-xl text-xs font-bold uppercase tracking-wide transition-all flex items-center justify-center gap-2\"\r\n                                        >\r\n                                            <i className=\"ri-delete-bin-line text-lg\"></i>\r\n                                            Delete\r\n                                        </button>\r\n                                        <div className=\"mt-auto pt-2 text-center\">\r\n                                            <span className={`inline-block px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest ${ticket.status === 'resolved' ? 'bg-gray-100 text-gray-500' :\r\n                                                ticket.status === 'in_progress' ? 'bg-blue-100 text-blue-600' :\r\n                                                    'bg-purple-100 text-purple-600'\r\n                                                }`}>\r\n                                                {ticket.status.replace('_', ' ')}\r\n                                            </span>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":["SupportTickets","profile","useAuth","navigate","useNavigate","tickets","setTickets","useState","loading","setLoading","filter","setFilter","useEffect","fetchTickets","query","supabase","data","error","updateStatus","id","newStatus","err","deleteTicket","jsxs","jsx","Navbar","f","ticket"],"mappings":"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"}