import{j as e}from"./query-vendor-CC_3ftG1.js";import{u as k,r as d}from"./react-vendor-Bsfkyusf.js";import{u as _,s as o,N as w}from"./index-BpkOjQCb.js";import"./i18n-vendor-CQdsz7qV.js";import"./supabase-vendor-C3liu3n-.js";function C(){const{profile:x}=_(),p=k(),[m,u]=d.useState([]),[f,g]=d.useState(!0),[n,h]=d.useState("all");d.useEffect(()=>{if(x?.role!=="admin"&&x?.role!=="super_admin"){p("/marketplace");return}c()},[n]);const c=async()=>{g(!0);const t=localStorage.getItem("sys_admin_bypass")==="true",l=localStorage.getItem("sys_admin_secret")||"pentvars-sys-admin-x892";try{if(t&&l){const{data:s,error:a}=await o.rpc("sys_get_support_tickets",{secret_key:l});if(a)throw a;const y=s.map(r=>({id:r.id,subject:r.subject,message:r.message,status:r.status,priority:r.priority,created_at:r.created_at,user_id:r.user_id,user:{full_name:r.user_full_name,email:r.user_email,phone:r.user_phone}})).filter(r=>n==="all"?!0:n==="open"?r.status==="open"||r.status==="in_progress":n==="resolved"?r.status==="resolved"||r.status==="closed":!0);u(y)}else{let s=o.from("support_tickets").select("*, user:profiles!user_id(full_name, email, phone)").order("created_at",{ascending:!1});n!=="all"&&(n==="open"?s=s.in("status",["open","in_progress"]):s=s.in("status",["resolved","closed"]));const{data:a,error:i}=await s;if(i)throw i;u(a||[])}}catch(s){console.error("Error fetching tickets:",s)}finally{g(!1)}},b=async(t,l)=>{try{const s=localStorage.getItem("sys_admin_bypass")==="true",a=localStorage.getItem("sys_admin_secret")||"pentvars-sys-admin-x892";if(s){const{error:i}=await o.rpc("sys_update_support_ticket",{ticket_id:t,new_status:l,secret_key:a});if(i)throw i}else{const{error:i}=await o.from("support_tickets").update({status:l}).eq("id",t);if(i)throw i}c()}catch(s){console.error("Error updating ticket",s)}},j=async t=>{if(confirm("Permanently delete this ticket?"))try{const l=localStorage.getItem("sys_admin_bypass")==="true",s=localStorage.getItem("sys_admin_secret")||"pentvars-sys-admin-x892";if(l){const{error:a}=await o.rpc("sys_delete_support_ticket",{ticket_id:t,secret_key:s});if(a)throw a}else{const{error:a}=await o.from("support_tickets").delete().eq("id",t);if(a)throw a}c()}catch(l){console.error("Error deleting ticket",l)}};return e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 transition-colors duration-300 pb-20 font-sans",children:[e.jsx(w,{}),e.jsxs("div",{className:"pt-32 md:pt-40 pb-12 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-6 mb-10",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:"px-3 py-1 rounded-full bg-pink-100 dark:bg-pink-900/30 text-pink-700 dark:text-pink-300 text-[10px] font-bold uppercase tracking-widest border border-pink-200 dark:border-pink-800",children:"Help Desk"})}),e.jsx("h1",{className:"text-3xl md:text-5xl font-black text-slate-900 dark:text-white tracking-tight mb-2",children:"Support Tickets"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 font-medium",children:"Manage user inquiries and issues."})]}),e.jsxs("button",{onClick:()=>p("/admin"),className:"px-6 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-200 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors text-xs font-bold uppercase tracking-wide whitespace-nowrap cursor-pointer flex items-center gap-2",children:[e.jsx("i",{className:"ri-arrow-left-line text-lg"}),"Back to Dashboard"]})]}),e.jsx("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2",children:["all","open","resolved"].map(t=>e.jsx("button",{onClick:()=>h(t),className:`px-4 py-2 rounded-xl text-xs font-bold uppercase tracking-widest transition-all ${n===t?"bg-slate-900 text-white dark:bg-white dark:text-slate-900":"bg-white text-slate-500 hover:bg-slate-100 dark:bg-slate-800 dark:text-slate-400"}`,children:t},t))}),f?e.jsx("div",{className:"text-center py-20",children:e.jsx("i",{className:"ri-loader-4-line text-4xl animate-spin text-blue-600"})}):m.length===0?e.jsxs("div",{className:"text-center py-20 bg-white dark:bg-slate-800 rounded-[2rem]",children:[e.jsx("div",{className:"w-20 h-20 bg-slate-50 dark:bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx("i",{className:"ri-customer-service-2-line text-4xl text-slate-300"})}),e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white",children:"No tickets found"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Great job! All caught up."})]}):e.jsx("div",{className:"grid grid-cols-1 gap-4",children:m.map(t=>e.jsx("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-sm hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-lg text-[10px] font-bold uppercase tracking-widest ${t.priority==="urgent"?"bg-red-100 text-red-700":t.priority==="high"?"bg-orange-100 text-orange-700":"bg-blue-100 text-blue-700"}`,children:t.priority}),e.jsxs("span",{className:"text-xs text-slate-400 font-mono",children:["#",t.id.slice(0,8)]}),e.jsxs("span",{className:"text-xs text-slate-400",children:["• ",new Date(t.created_at).toLocaleDateString()]})]}),e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white mb-2",children:t.subject}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 text-sm leading-relaxed mb-4 p-4 bg-slate-50 dark:bg-slate-900/50 rounded-xl",children:t.message}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-slate-500 font-bold text-xs",children:t.user?.full_name?.charAt(0)}),e.jsxs("div",{className:"text-xs",children:[e.jsx("p",{className:"font-bold text-slate-900 dark:text-white",children:t.user?.full_name||"Unknown User"}),e.jsxs("p",{className:"text-slate-500",children:[t.user?.email," • ",t.user?.phone]})]})]})]}),e.jsxs("div",{className:"flex flex-row md:flex-col gap-2 justify-center md:border-l md:border-slate-100 md:dark:border-slate-700 md:pl-6 min-w-[150px]",children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-1 hidden md:block",children:"Actions"}),t.status!=="resolved"&&e.jsxs("button",{onClick:()=>b(t.id,"resolved"),className:"px-4 py-2 bg-emerald-50 text-emerald-600 rounded-xl text-xs font-bold uppercase tracking-wide hover:bg-emerald-100 transition-colors flex items-center justify-center gap-2",children:[e.jsx("i",{className:"ri-check-line text-lg"}),"Resolve"]}),t.status!=="in_progress"&&t.status!=="resolved"&&e.jsxs("button",{onClick:()=>b(t.id,"in_progress"),className:"px-4 py-2 bg-blue-50 text-blue-600 rounded-xl text-xs font-bold uppercase tracking-wide hover:bg-blue-100 transition-colors flex items-center justify-center gap-2",children:[e.jsx("i",{className:"ri-loader-2-line text-lg"}),"Process"]}),e.jsxs("button",{onClick:()=>j(t.id),className:"px-4 py-2 opacity-40 hover:opacity-100 text-rose-600 rounded-xl text-xs font-bold uppercase tracking-wide transition-all flex items-center justify-center gap-2",children:[e.jsx("i",{className:"ri-delete-bin-line text-lg"}),"Delete"]}),e.jsx("div",{className:"mt-auto pt-2 text-center",children:e.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest ${t.status==="resolved"?"bg-gray-100 text-gray-500":t.status==="in_progress"?"bg-blue-100 text-blue-600":"bg-purple-100 text-purple-600"}`,children:t.status.replace("_"," ")})})]})]})},t.id))})]})]})}export{C as default};
//# sourceMappingURL=SupportTickets-DRjpZiLG.js.map
