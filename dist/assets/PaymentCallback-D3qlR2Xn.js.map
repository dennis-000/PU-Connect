{"version":3,"file":"PaymentCallback-D3qlR2Xn.js","sources":["../../src/pages/payment/PaymentCallback.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport { useNavigate, useSearchParams } from 'react-router-dom';\r\nimport { useAuth } from '../../contexts/AuthContext';\r\nimport { supabase } from '../../lib/supabase';\r\nimport Navbar from '../../components/feature/Navbar';\r\n\r\nexport default function PaymentCallback() {\r\n  const [searchParams] = useSearchParams();\r\n  const navigate = useNavigate();\r\n  const { user } = useAuth();\r\n  const [status, setStatus] = useState<'verifying' | 'success' | 'failed'>('verifying');\r\n  const [message, setMessage] = useState('Verifying your payment...');\r\n\r\n  useEffect(() => {\r\n    const reference = searchParams.get('reference');\r\n\r\n    if (!reference || !user) {\r\n      setStatus('failed');\r\n      setMessage('Invalid payment reference');\r\n      return;\r\n    }\r\n\r\n    verifyPayment(reference);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [searchParams, user]);\r\n\r\n  const verifyPayment = async (reference: string) => {\r\n    try {\r\n      const { data, error } = await supabase.functions.invoke('verify-paystack-payment', {\r\n        body: {\r\n          reference,\r\n          seller_id: user?.id,\r\n        },\r\n      });\r\n\r\n      if (error) throw error;\r\n\r\n      if (data.success) {\r\n        setStatus('success');\r\n\r\n        if (data.type === 'sms_topup') {\r\n          setMessage(`Payment successful! ${data.units} SMS units have been added to your record.`);\r\n          setTimeout(() => {\r\n            navigate('/admin/sms');\r\n          }, 3000);\r\n        } else {\r\n          setMessage('Payment successful! Your seller account is now active.');\r\n          setTimeout(() => {\r\n            navigate('/seller/dashboard');\r\n          }, 3000);\r\n        }\r\n      } else {\r\n        setStatus('failed');\r\n        setMessage('Payment verification failed. Please contact support.');\r\n      }\r\n    } catch (err: any) {\r\n      console.error('Verification error:', err);\r\n      setStatus('failed');\r\n      setMessage('Failed to verify payment. Please contact support with your payment reference.');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n\r\n      <div className=\"max-w-3xl mx-auto px-6 py-20 relative min-h-[calc(100vh-80px)] flex items-center justify-center\">\r\n        {/* Background Decorative Element */}\r\n        <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[150%] aspect-square bg-gradient-to-br from-blue-500/5 to-emerald-600/5 rounded-full blur-[120px] pointer-events-none -z-10\"></div>\r\n\r\n        <div className=\"bg-white rounded-[2.5rem] shadow-xl shadow-gray-200/40 border border-gray-100 p-12 md:p-20 text-center w-full relative overflow-hidden\">\r\n          {/* Subtle grid pattern */}\r\n          <div className=\"absolute inset-0 opacity-[0.03] pointer-events-none\" style={{ backgroundImage: 'radial-gradient(#000 1px, transparent 1px)', backgroundSize: '20px 20px' }}></div>\r\n\r\n          {status === 'verifying' && (\r\n            <div className=\"relative z-10 animate-in fade-in zoom-in duration-500\">\r\n              <div className=\"w-20 h-20 bg-blue-100 rounded-2xl flex items-center justify-center mx-auto mb-10 shadow-lg\">\r\n                <i className=\"ri-loader-4-line text-4xl text-blue-600 animate-spin\"></i>\r\n              </div>\r\n              <div className=\"inline-flex items-center gap-2 px-4 py-1.5 bg-gray-900 text-white text-[10px] font-bold uppercase tracking-wide rounded-full mb-6\">\r\n                <i className=\"ri-shield-check-line text-blue-400\"></i>\r\n                Payment Verification\r\n              </div>\r\n              <h2 className=\"text-3xl md:text-5xl font-bold text-gray-900 mb-6 tracking-tight\">\r\n                Verifying <span className=\"text-blue-600\">Payment.</span>\r\n              </h2>\r\n              <p className=\"text-gray-500 font-bold uppercase tracking-wide text-[10px] md:text-xs max-w-sm mx-auto leading-relaxed\">\r\n                {message}\r\n              </p>\r\n            </div>\r\n          )}\r\n\r\n          {status === 'success' && (\r\n            <div className=\"relative z-10 animate-in fade-in zoom-in duration-500\">\r\n              <div className=\"w-20 h-20 bg-emerald-100 rounded-2xl flex items-center justify-center mx-auto mb-10 shadow-lg\">\r\n                <i className=\"ri-check-double-line text-4xl text-emerald-600\"></i>\r\n              </div>\r\n              <div className=\"inline-flex items-center gap-2 px-4 py-1.5 bg-emerald-600 text-white text-[10px] font-bold uppercase tracking-wide rounded-full mb-6\">\r\n                <i className=\"ri-checkbox-circle-line\"></i>\r\n                Process Complete\r\n              </div>\r\n              <h2 className=\"text-3xl md:text-5xl font-bold text-gray-900 mb-6 tracking-tight\">\r\n                Payment <span className=\"text-emerald-600\">Successful.</span>\r\n              </h2>\r\n              <p className=\"text-gray-500 font-bold uppercase tracking-wide text-[10px] md:text-xs max-w-sm mx-auto leading-relaxed mb-10\">\r\n                {message}\r\n              </p>\r\n              <div className=\"flex items-center justify-center gap-3 py-4 bg-gray-50 rounded-2xl border border-gray-100 text-[10px] font-bold text-gray-400 uppercase tracking-wide\">\r\n                <i className=\"ri-refresh-line animate-spin text-blue-500\"></i>\r\n                Redirecting to dashboard...\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {status === 'failed' && (\r\n            <div className=\"relative z-10 animate-in fade-in zoom-in duration-500\">\r\n              <div className=\"w-20 h-20 bg-rose-100 rounded-2xl flex items-center justify-center mx-auto mb-10 shadow-lg\">\r\n                <i className=\"ri-close-circle-line text-4xl text-rose-600\"></i>\r\n              </div>\r\n              <div className=\"inline-flex items-center gap-2 px-4 py-1.5 bg-rose-600 text-white text-[10px] font-bold uppercase tracking-wide rounded-full mb-6\">\r\n                <i className=\"ri-error-warning-line\"></i>\r\n                Verification Failed\r\n              </div>\r\n              <h2 className=\"text-3xl md:text-5xl font-bold text-gray-900 mb-6 tracking-tight\">\r\n                Payment <span className=\"text-rose-600\">Issue.</span>\r\n              </h2>\r\n              <p className=\"text-gray-500 font-bold uppercase tracking-wide text-[10px] md:text-xs max-w-sm mx-auto leading-relaxed mb-10\">\r\n                {message}\r\n              </p>\r\n              <button\r\n                onClick={() => navigate('/seller/become')}\r\n                className=\"w-full px-10 py-5 bg-gray-900 text-white font-bold text-xs uppercase tracking-wide rounded-2xl hover:bg-black transition-all active:scale-[0.98] flex items-center justify-center gap-3\"\r\n              >\r\n                <i className=\"ri-refresh-line text-lg\"></i>\r\n                Try Again\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["PaymentCallback","searchParams","useSearchParams","navigate","useNavigate","user","useAuth","status","setStatus","useState","message","setMessage","useEffect","reference","verifyPayment","data","error","supabase","err","jsxs","jsx","Navbar"],"mappings":"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"}