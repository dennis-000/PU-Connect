const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CcOhh2SE.js","assets/query-vendor-CC_3ftG1.js","assets/react-vendor-Bsfkyusf.js","assets/i18n-vendor-CQdsz7qV.js","assets/supabase-vendor-C3liu3n-.js","assets/index-1ug13H_y.css"])))=>i.map(i=>d[i]);
import{_ as N}from"./supabase-vendor-C3liu3n-.js";import{j as e}from"./query-vendor-CC_3ftG1.js";import{u as R,r as d}from"./react-vendor-Bsfkyusf.js";import{u as I,N as P,g as _}from"./index-CcOhh2SE.js";import{u as L,b as $}from"./useConversations-g8fwN2cl.js";import"./i18n-vendor-CQdsz7qV.js";function q(){const{profile:c,user:l}=I(),C=R(),{conversations:u,isLoading:S}=L(),[a,x]=d.useState(null),{messages:n,isLoading:E,sendMessage:g,markAsRead:f}=$(a?.id||null),[m,p]=d.useState(""),y=d.useRef(null),[b,h]=d.useState(!1),[w,M]=d.useState([]);d.useEffect(()=>{c?.role!=="admin"&&c?.role!=="super_admin"&&c?.role},[c,C]),d.useEffect(()=>{b&&(async()=>{const{data:t}=await N(async()=>{const{supabase:s}=await import("./index-CcOhh2SE.js").then(i=>i.j);return{supabase:s}},__vite__mapDeps([0,1,2,3,4,5])).then(({supabase:s})=>s.from("profiles").select("id, full_name, role, avatar_url").in("role",["admin","super_admin","news_publisher"]).neq("id",l?.id));t&&M(t)})()},[b,l?.id]),d.useEffect(()=>{if(a&&n.length>0){const r=n.filter(t=>!t.is_read&&t.sender_id!==l?.id).map(t=>t.id);r.length>0&&f.mutate(r)}},[a,n,l?.id,f]),d.useEffect(()=>{y.current?.scrollIntoView({behavior:"smooth"})},[n]);const A=async r=>{if(r.preventDefault(),!m.trim()||!a||!l)return;const t=a.buyer_id===l.id?a.seller_id:a.buyer_id;g.mutate({message:m.trim(),receiverId:t},{onSuccess:()=>{p("")}})},D=async r=>{const t=u.find(s=>s.buyer_id===r.id||s.seller_id===r.id);if(t)x(t),h(!1);else{const{supabase:s}=await N(async()=>{const{supabase:i}=await import("./index-CcOhh2SE.js").then(o=>o.j);return{supabase:i}},__vite__mapDeps([0,1,2,3,4,5]));try{const{data:i,error:o}=await s.from("conversations").insert({buyer_id:l?.id,seller_id:r.id}).select().single();if(o)if(o.code==="23503"){const{error:j}=await s.from("profiles").upsert({id:l?.id,email:l?.email,full_name:"Admin User",role:"admin",created_at:new Date().toISOString()});if(j)throw j;{const{data:k,error:v}=await s.from("conversations").insert({buyer_id:l?.id,seller_id:r.id}).select().single();if(k)x(k),window.location.reload();else if(v)throw v}}else throw o;else i&&(x(i),window.location.reload())}catch(i){console.error("Failed to start chat:",i),alert("Failed to start conversation. Please try again.")}h(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gray-50/50 dark:bg-gray-950 transition-colors duration-300",children:[e.jsx(P,{}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-12 pt-28 pb-10 md:pt-32 md:pb-16",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-6 mb-8",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-1.5 bg-gray-900 dark:bg-blue-600 text-white text-[10px] font-bold uppercase tracking-wide rounded-full mb-6 shadow-lg shadow-gray-200/20 dark:shadow-blue-900/40",children:[e.jsx("i",{className:"ri-team-line text-blue-400 dark:text-white"}),"Internal Comms"]}),e.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 dark:text-white tracking-tight leading-tight",children:["Team",e.jsx("br",{}),e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Chat."})]})]}),e.jsxs("button",{onClick:()=>h(!0),className:"px-6 py-3 bg-blue-600 text-white rounded-xl font-bold text-sm shadow-lg hover:bg-blue-700 transition-all flex items-center gap-2",children:[e.jsx("i",{className:"ri-add-line text-lg"}),"New Chat"]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-[2.5rem] border border-gray-100 dark:border-gray-800 shadow-xl shadow-gray-200/40 dark:shadow-none overflow-hidden transition-colors duration-300",style:{height:"calc(100vh - 350px)"},children:e.jsxs("div",{className:"grid grid-cols-12 h-full",children:[e.jsx("div",{className:"col-span-12 md:col-span-4 border-r border-gray-50 dark:border-gray-800 overflow-y-auto",children:S?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"w-10 h-10 border-4 border-gray-100 dark:border-gray-800 border-t-blue-600 rounded-full animate-spin"})}):u.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-10 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-50 dark:bg-gray-800 rounded-2xl flex items-center justify-center mb-6",children:e.jsx("i",{className:"ri-message-3-line text-3xl text-gray-400 dark:text-gray-500"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white tracking-tight mb-2",children:"No active chats"}),e.jsx("p",{className:"text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wide leading-relaxed",children:"Start a conversation to see it here"})]}):e.jsx("div",{className:"divide-y divide-gray-50 dark:divide-gray-800",children:u.map(r=>{const t=r.other_user,s=(r.unread_count||0)>0;return e.jsxs("div",{onClick:()=>x(r),className:`p-6 hover:bg-gray-50/50 dark:hover:bg-gray-800/50 cursor-pointer transition-all relative ${a?.id===r.id?"bg-blue-50/30 dark:bg-blue-900/10":""}`,children:[a?.id===r.id&&e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-blue-600"}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"relative flex-shrink-0",children:t?.avatar_url?e.jsx("img",{src:_(t.avatar_url,40,40),alt:t.full_name,className:"w-10 h-10 rounded-xl object-cover border border-gray-100 dark:border-gray-700"}):e.jsx("div",{className:"w-10 h-10 bg-gray-900 dark:bg-gray-700 rounded-xl flex items-center justify-center text-white font-bold text-xs",children:t?.full_name?.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("h3",{className:`text-[11px] uppercase tracking-wider truncate ${s?"font-black text-gray-900 dark:text-white":"font-bold text-gray-700 dark:text-gray-300"}`,children:t?.full_name}),e.jsx("p",{className:`text-xs truncate leading-relaxed ${s?"font-bold text-gray-900 dark:text-white":"font-semibold text-gray-500 dark:text-gray-500"}`,children:r.last_message||"Attachment"})]})]}),e.jsxs("div",{className:"flex items-center justify-between ml-13 pl-1",children:[e.jsx("span",{className:"text-[9px] font-bold text-gray-400 dark:text-gray-600 tabular-nums uppercase tracking-wide",children:new Date(r.last_message_at).toLocaleDateString()}),s&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-blue-600 text-white text-[9px] font-bold rounded-md shadow-sm",children:[r.unread_count," new"]})]})]},r.id)})})}),e.jsx("div",{className:"col-span-12 md:col-span-8 flex flex-col bg-gray-50/20 dark:bg-black/20",children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-6 border-b border-gray-50 dark:border-gray-800 bg-white/50 dark:bg-gray-900/50 backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[a.other_user?.avatar_url?e.jsx("img",{src:_(a.other_user.avatar_url,50,50),className:"w-12 h-12 rounded-2xl object-cover shadow-sm dark:shadow-none border border-gray-100 dark:border-gray-800"}):e.jsx("div",{className:"w-12 h-12 bg-gray-900 dark:bg-gray-800 rounded-2xl flex items-center justify-center text-white font-bold",children:a.other_user?.full_name?.charAt(0)}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wide mb-1 leading-none",children:"Chatting With"}),e.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white tracking-tight",children:a.other_user?.full_name})]})]}),a.product&&e.jsxs("div",{className:"text-right hidden md:block",children:[e.jsx("p",{className:"text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wide mb-1 leading-none",children:"Context"}),e.jsx("p",{className:"text-xs font-bold text-blue-600 dark:text-blue-400 uppercase tracking-tight",children:a.product.name})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-8 space-y-6",children:[E?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"w-8 h-8 border-4 border-gray-200 dark:border-gray-800 border-t-blue-600 rounded-full animate-spin"})}):n.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-[10px] font-bold text-gray-400 dark:text-gray-600 uppercase tracking-wide",children:"No messages yet. Say hello!"})}):n.map(r=>{const t=r.sender_id===l?.id;return e.jsxs("div",{className:`flex flex-col ${t?"items-end":"items-start"}`,children:[e.jsxs("div",{className:`flex items-end gap-2 max-w-[80%] ${t?"flex-row-reverse":"flex-row"}`,children:[!t&&e.jsx("div",{className:"w-6 h-6 bg-gray-200 dark:bg-gray-800 rounded-lg flex-shrink-0 flex items-center justify-center text-[10px] font-bold text-gray-500 dark:text-gray-400",children:r.sender?.full_name?.[0]}),e.jsx("div",{className:`px-5 py-3 rounded-2xl shadow-sm border text-sm font-medium leading-relaxed ${t?"bg-gray-900 dark:bg-blue-600 text-white border-transparent rounded-tr-none":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 border-gray-100 dark:border-gray-700 rounded-tl-none conversation-bubble"}`,children:r.message})]}),e.jsx("span",{className:"text-[9px] font-bold text-gray-400 dark:text-gray-600 uppercase tracking-wide mt-1 mx-9",children:new Date(r.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},r.id)}),e.jsx("div",{ref:y})]}),e.jsx("div",{className:"p-4 bg-white dark:bg-gray-900 border-t border-gray-50 dark:border-gray-800",children:e.jsxs("form",{onSubmit:A,className:"relative",children:[e.jsx("input",{type:"text",value:m,onChange:r=>p(r.target.value),placeholder:"Type your message...",className:"w-full pl-6 pr-32 py-4 bg-gray-50 dark:bg-gray-800 border-none rounded-2xl focus:ring-2 focus:ring-blue-600/20 focus:bg-white dark:focus:bg-gray-800 text-sm font-medium text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 transition-all",disabled:g.isPending}),e.jsx("div",{className:"absolute right-2 top-1/2 -translate-y-1/2",children:e.jsxs("button",{type:"submit",disabled:g.isPending||!m.trim(),className:"px-6 py-2.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-all text-xs font-bold uppercase tracking-widest disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer flex items-center gap-2 shadow-lg shadow-blue-200 dark:shadow-none",children:[g.isPending?e.jsx("i",{className:"ri-loader-4-line animate-spin"}):e.jsx("i",{className:"ri-send-plane-fill"}),e.jsx("span",{children:"Send"})]})})]})})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-white dark:bg-gray-800 rounded-[1.5rem] shadow-sm border border-gray-100 dark:border-gray-800 flex items-center justify-center mx-auto mb-6",children:e.jsx("i",{className:"ri-chat-smile-2-line text-3xl text-gray-300 dark:text-gray-600"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white tracking-tight mb-2",children:"Select a Conversation"}),e.jsx("p",{className:"text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wide",children:"Choose a colleague from the list to start chatting"})]})})})]})})]}),b&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 w-full max-w-md rounded-3xl shadow-2xl overflow-hidden border border-gray-100 dark:border-gray-800",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100 dark:border-gray-800 flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"New Message"}),e.jsx("button",{onClick:()=>h(!1),className:"w-8 h-8 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 flex items-center justify-center transition-colors",children:e.jsx("i",{className:"ri-close-line text-xl"})})]}),e.jsxs("div",{className:"max-h-[60vh] overflow-y-auto p-4 space-y-2",children:[w.map(r=>e.jsxs("div",{onClick:()=>D(r),className:"flex items-center gap-4 p-3 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl cursor-pointer transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-full flex items-center justify-center font-bold",children:r.full_name[0]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-sm dark:text-white",children:r.full_name}),e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:r.role.replace("_"," ")})]})]},r.id)),w.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-4",children:"No other admins found."})]})]})})]})}export{q as default};
//# sourceMappingURL=AdminMessages-BcafcbyK.js.map
