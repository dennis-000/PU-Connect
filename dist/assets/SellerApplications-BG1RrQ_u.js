const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/arkesel-C1VSO6Pc.js","assets/index-BpkOjQCb.js","assets/query-vendor-CC_3ftG1.js","assets/react-vendor-Bsfkyusf.js","assets/i18n-vendor-CQdsz7qV.js","assets/supabase-vendor-C3liu3n-.js","assets/index-DcDPJUwr.css"])))=>i.map(i=>d[i]);
import{_ as L}from"./supabase-vendor-C3liu3n-.js";import{j as e}from"./query-vendor-CC_3ftG1.js";import{u as T,r as a}from"./react-vendor-Bsfkyusf.js";import{u as U,s as l,N as C}from"./index-BpkOjQCb.js";import"./i18n-vendor-CQdsz7qV.js";function W({isEmbedded:u=!1}){const N=T(),{profile:t}=U(),[c,E]=a.useState([]),[j,P]=a.useState(!0),[y,$]=a.useState("all"),[b,w]=a.useState(null),[D,v]=a.useState(!1),[x,k]=a.useState(""),[i,m]=a.useState(!1),[n,o]=a.useState(null);a.useEffect(()=>{if(n){const r=setTimeout(()=>o(null),4e3);return()=>clearTimeout(r)}},[n]),a.useEffect(()=>{if(t?.role!=="admin"&&t?.role!=="super_admin"){N("/");return}g();const r=l.channel("seller_applications_changes").on("postgres_changes",{event:"*",schema:"public",table:"seller_applications"},()=>{g()}).subscribe();return()=>{l.removeChannel(r)}},[t,N]);const g=async()=>{try{const{data:r,error:s}=await l.from("seller_applications").select(`
          *,
          profiles:user_id (
            full_name,
            email,
            student_id
          )
        `).order("updated_at",{ascending:!1});console.log("Admin Dashboard: Current User:",t?.role,t?.id),console.log("Admin Dashboard: Fetched Applications:",r),E(r||[])}catch(r){console.error("Error fetching applications:",r)}finally{P(!1)}},_=async r=>{if(confirm(`Approve ${r.business_name}?`)){m(!0);try{const s=localStorage.getItem("sys_admin_secret")||"your_secret_admin_key_here",p=t?.id&&t.id!=="00000000-0000-0000-0000-000000000000"?t.id:null,{error:d}=await l.rpc("admin_approve_seller_application",{application_id:r.id,secret_key:s,admin_id:p});if(d)throw d;if(r.contact_phone)try{const{sendSMS:f}=await L(async()=>{const{sendSMS:M}=await import("./arkesel-C1VSO6Pc.js");return{sendSMS:M}},__vite__mapDeps([0,1,2,3,4,5,6])),I=r.profiles?.full_name.split(" ")[0]||"User";await f([r.contact_phone],`Hi ${I}, congratulations! Your seller application for "${r.business_name}" on PU Connect has been APPROVED. You can now log in and start listing your products. Happy selling!`)}catch(f){console.error("Failed to send approval SMS:",f)}try{await l.from("activity_logs").insert({user_id:t?.id,action_type:"application_approved",action_details:{business_name:r.business_name,applicant_id:r.user_id,applicant_name:r.profiles?.full_name}})}catch(f){console.error("Error logging approval:",f)}o({type:"success",message:"Application approved successfully! SMS notification sent."}),g()}catch(s){console.error("Error approving application:",s),o({type:"error",message:"Failed to approve: "+s.message})}finally{m(!1)}}},S=r=>{w(r),k(""),v(!0)},A=async r=>{if(confirm(`Reset application for ${r.business_name} to Pending?`)){m(!0);try{const{error:s}=await l.from("seller_applications").update({status:"pending",updated_at:new Date().toISOString()}).eq("id",r.id);if(s)throw s;if(r.status==="approved"){const p=localStorage.getItem("sys_admin_secret")||"your_secret_admin_key_here",{error:d}=await l.rpc("admin_update_user_role",{target_user_id:r.user_id,new_role:"buyer",secret_key:p});d?(console.error("Failed to revert role via RPC:",d),alert("Warning: Application reset but failed to revert user role.")):await l.from("seller_profiles").update({is_active:!1}).eq("user_id",r.user_id)}o({type:"success",message:"Application reset to Pending"}),g()}catch(s){o({type:"error",message:"Error resetting: "+s.message})}finally{m(!1)}}},F=async()=>{if(!b||!x.trim()){alert("Please provide a rejection reason");return}m(!0);try{const r=localStorage.getItem("sys_admin_secret")||"your_secret_admin_key_here",s=t?.id&&t.id!=="00000000-0000-0000-0000-000000000000"?t.id:null,{error:p}=await l.rpc("admin_reject_seller_application",{application_id:b.id,reason:x,secret_key:r,admin_id:s});if(p)throw p;try{await l.from("activity_logs").insert({user_id:t?.id,action_type:"application_rejected",action_details:{business_name:b.business_name,reason:x,applicant_name:b.profiles?.full_name}})}catch(d){console.error("Error logging rejection:",d)}o({type:"success",message:"Application rejected successfully"}),v(!1),w(null),g()}catch(r){console.error("Error rejecting application:",r),o({type:"error",message:"Failed to reject: "+r.message})}finally{m(!1)}},R=c.filter(r=>y==="all"?!0:r.status===y),h={total:c.length,pending:c.filter(r=>r.status==="pending").length,approved:c.filter(r=>r.status==="approved").length,rejected:c.filter(r=>r.status==="rejected").length,cancelled:c.filter(r=>r.status==="cancelled").length};return j?e.jsxs("div",{className:u?"py-20":"min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-50 dark:from-gray-950 dark:via-gray-900 dark:to-gray-950 transition-colors duration-300",children:[!u&&e.jsx(C,{}),e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-teal-600 border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Loading applications..."})]})})]}):e.jsxs("div",{className:u?"animate-in fade-in duration-500":"min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-50 dark:from-gray-950 dark:via-gray-900 dark:to-gray-950 transition-colors duration-300",children:[!u&&e.jsx(C,{}),e.jsxs("div",{className:u?"w-full":"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-32 pb-12",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-teal-500 to-teal-600 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx("i",{className:"ri-file-list-3-line text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Seller Applications"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Review and manage seller applications"})]})]}),e.jsxs("button",{onClick:()=>g(),disabled:j,className:"flex items-center gap-2 px-6 py-2.5 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 font-bold text-xs uppercase tracking-widest rounded-xl border border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all shadow-sm active:scale-95 disabled:opacity-50",children:[e.jsx("i",{className:`ri-refresh-line ${j?"animate-spin":""}`}),"Sync Data"]})]}),n&&e.jsxs("div",{className:`fixed top-24 right-4 md:right-8 z-50 animate-in fade-in slide-in-from-right-8 duration-300 px-6 py-4 rounded-2xl shadow-2xl border flex items-center gap-3 backdrop-blur-md ${n.type==="success"?"bg-emerald-500/90 border-emerald-400/50 text-white":n.type==="error"?"bg-rose-500/90 border-rose-400/50 text-white":"bg-blue-500/90 border-blue-400/50 text-white"}`,children:[e.jsx("i",{className:`${n.type==="success"?"ri-checkbox-circle-fill":n.type==="error"?"ri-error-warning-fill":"ri-notification-3-fill"} text-xl`}),e.jsx("span",{className:"font-bold text-sm tracking-wide",children:n.message})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mb-8",children:[e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 border border-gray-100 dark:border-gray-800 shadow-sm transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Total Applications"}),e.jsx("h3",{className:"text-2xl font-black text-gray-900 dark:text-white",children:h.total})]}),e.jsx("div",{className:"w-10 h-10 bg-blue-500/10 rounded-lg flex items-center justify-center text-blue-500",children:e.jsx("i",{className:"ri-file-list-3-fill text-xl"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 border border-gray-100 dark:border-gray-800 shadow-sm transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Pending Review"}),e.jsx("h3",{className:"text-2xl font-black text-amber-500",children:h.pending})]}),e.jsx("div",{className:"w-10 h-10 bg-amber-500/10 rounded-lg flex items-center justify-center text-amber-500",children:e.jsx("i",{className:"ri-time-fill text-xl"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 border border-gray-100 dark:border-gray-800 shadow-sm transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Approved"}),e.jsx("h3",{className:"text-2xl font-black text-emerald-500",children:h.approved})]}),e.jsx("div",{className:"w-10 h-10 bg-emerald-500/10 rounded-lg flex items-center justify-center text-emerald-500",children:e.jsx("i",{className:"ri-checkbox-circle-fill text-xl"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 border border-gray-100 dark:border-gray-800 shadow-sm transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Rejected"}),e.jsx("h3",{className:"text-2xl font-black text-red-500",children:h.rejected})]}),e.jsx("div",{className:"w-10 h-10 bg-red-500/10 rounded-lg flex items-center justify-center text-red-500",children:e.jsx("i",{className:"ri-close-circle-fill text-xl"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 border border-gray-100 dark:border-gray-800 shadow-sm transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Cancelled"}),e.jsx("h3",{className:"text-2xl font-black text-slate-500",children:h.cancelled})]}),e.jsx("div",{className:"w-10 h-10 bg-slate-500/10 rounded-lg flex items-center justify-center text-slate-500",children:e.jsx("i",{className:"ri-prohibited-line text-xl"})})]})})]}),e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-2 mb-6 border border-gray-100 dark:border-gray-800 shadow-sm inline-flex gap-2 w-full sm:w-auto overflow-x-auto transition-colors",children:["all","pending","approved","rejected","cancelled"].map(r=>e.jsxs("button",{onClick:()=>$(r),className:`px-6 py-2 rounded-lg font-medium text-sm transition-all whitespace-nowrap cursor-pointer ${y===r?"bg-gradient-to-r from-teal-500 to-teal-600 text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[r.charAt(0).toUpperCase()+r.slice(1),r!=="all"&&e.jsx("span",{className:`ml-2 px-2 py-0.5 rounded-full text-xs ${y===r?"bg-white/20":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400"}`,children:h[r]})]},r))}),e.jsx("div",{className:"space-y-4",children:R.length===0?e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-12 text-center border border-gray-100 dark:border-gray-800 transition-colors",children:[e.jsx("i",{className:"ri-inbox-line text-6xl text-gray-300 dark:text-gray-700 mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No applications found"})]}):R.map(r=>e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 border border-gray-100 dark:border-gray-800 shadow-sm hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-start lg:justify-between gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-teal-500 to-teal-600 rounded-xl flex items-center justify-center flex-shrink-0 shadow-md overflow-hidden",children:r.business_logo?e.jsx("img",{src:`${r.business_logo}?t=${new Date(r.updated_at).getTime()}`,alt:"",className:"w-full h-full object-cover"}):e.jsx("i",{className:"ri-store-3-line text-2xl text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:r.business_name}),r.business_name.startsWith("[Mock]")&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-500/10 text-blue-500 text-[10px] font-black uppercase rounded",children:"System Test"}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${r.status==="approved"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300":r.status==="rejected"?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300"}`,children:r.status.toUpperCase()})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:[e.jsx("i",{className:"ri-user-line mr-1"}),r.profiles?.full_name]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("i",{className:"ri-price-tag-3-line mr-1"}),r.business_category]})]})]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 mb-4 transition-colors",children:e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 leading-relaxed",children:r.business_description})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("i",{className:"ri-phone-line text-teal-600 dark:text-teal-400"}),e.jsx("span",{children:r.contact_phone})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("i",{className:"ri-mail-line text-teal-600 dark:text-teal-400"}),e.jsx("span",{children:r.contact_email})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500 dark:text-gray-500",children:[e.jsxs("span",{children:[e.jsx("i",{className:"ri-calendar-line mr-1"}),"Applied: ",new Date(r.created_at).toLocaleDateString()]}),r.updated_at!==r.created_at&&e.jsxs("span",{children:[e.jsx("i",{className:"ri-refresh-line mr-1"}),"Updated: ",new Date(r.updated_at).toLocaleDateString()]})]}),r.admin_notes&&e.jsxs("div",{className:"mt-4 bg-red-50 dark:bg-red-900/10 border border-red-200 dark:border-red-900/30 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-red-900 dark:text-red-300 mb-1",children:"Rejection Reason:"}),e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200/80",children:r.admin_notes})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 lg:w-48",children:[r.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>_(r),disabled:i,className:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg hover:from-green-600 hover:to-green-700 transition-all font-medium text-sm whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer flex items-center justify-center gap-2 shadow-sm",children:[e.jsx("i",{className:"ri-checkbox-circle-line text-lg"}),"Approve"]}),e.jsxs("button",{onClick:()=>S(r),disabled:i,className:"w-full px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all font-medium text-sm whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer flex items-center justify-center gap-2 shadow-sm",children:[e.jsx("i",{className:"ri-close-circle-line text-lg"}),"Reject"]})]}),r.status==="approved"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>S(r),disabled:i,className:"w-full px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all font-medium text-sm whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer flex items-center justify-center gap-2 shadow-sm",children:[e.jsx("i",{className:"ri-prohibited-line text-lg"}),"Revoke"]}),e.jsxs("button",{onClick:()=>A(r),disabled:i,className:"w-full px-6 py-3 bg-white border border-yellow-500 text-yellow-600 rounded-lg hover:bg-yellow-50 transition-all font-medium text-sm whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer flex items-center justify-center gap-2 shadow-sm",children:[e.jsx("i",{className:"ri-history-line text-lg"}),"Re-evaluate"]})]}),r.status==="rejected"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>_(r),disabled:i,className:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg hover:from-green-600 hover:to-green-700 transition-all font-medium text-sm whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer flex items-center justify-center gap-2 shadow-sm",children:[e.jsx("i",{className:"ri-checkbox-circle-line text-lg"}),"Approve"]}),e.jsxs("button",{onClick:()=>A(r),disabled:i,className:"w-full px-6 py-3 bg-white border border-yellow-500 text-yellow-600 rounded-lg hover:bg-yellow-50 transition-all font-medium text-sm whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer flex items-center justify-center gap-2 shadow-sm",children:[e.jsx("i",{className:"ri-history-line text-lg"}),"Re-evaluate"]})]})]})]})},r.id))})]}),D&&e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center p-4 z-50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl max-w-md w-full p-6 shadow-2xl border border-gray-100 dark:border-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx("i",{className:"ri-close-circle-line text-2xl text-white"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Reject Application"})]}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:["Please provide a reason for rejecting ",e.jsx("strong",{children:b?.business_name})]}),e.jsx("textarea",{value:x,onChange:r=>k(r.target.value),placeholder:"Enter rejection reason...",rows:4,maxLength:500,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent resize-none mb-2 outline-none"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mb-4",children:[x.length,"/500 characters"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{v(!1),w(null)},disabled:i,className:"flex-1 px-6 py-3 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-all font-medium text-sm whitespace-nowrap disabled:opacity-50 cursor-pointer",children:"Cancel"}),e.jsx("button",{onClick:F,disabled:i||!x.trim(),className:"flex-1 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all font-medium text-sm whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer shadow-md",children:i?"Rejecting...":"Confirm Rejection"})]})]})})]})}export{W as default};
//# sourceMappingURL=SellerApplications-BG1RrQ_u.js.map
