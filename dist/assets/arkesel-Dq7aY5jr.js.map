{"version":3,"file":"arkesel-Dq7aY5jr.js","sources":["../../src/lib/arkesel.ts"],"sourcesContent":["import { supabase } from './supabase';\r\n\r\nconst API_KEY = import.meta.env.VITE_ARKESEL_API_KEY || 'RHNPVVNWaU5uYW1hcllVVXJvZlY';\r\n\r\nexport const sendSMS = async (recipients: string[], message: string) => {\r\n    try {\r\n        // Check Global Toggle\r\n        const { data: settings } = await supabase\r\n            .from('website_settings')\r\n            .select('enable_sms')\r\n            .single();\r\n\r\n        if (settings && settings.enable_sms === false) {\r\n            console.log('ðŸš« SMS Blocked: Feature is disabled globally in settings.');\r\n            return { success: true, status: 'skipped', message: 'SMS disabled globally' };\r\n        }\r\n\r\n        const response = await fetch('https://sms.arkesel.com/api/v2/sms/send', {\r\n            method: 'POST',\r\n            headers: {\r\n                'api-key': API_KEY,\r\n                'Content-Type': 'application/json',\r\n            },\r\n            body: JSON.stringify({\r\n                sender: 'CampConnect',\r\n                message: message,\r\n                recipients: recipients,\r\n            }),\r\n        });\r\n        const result = await response.json();\r\n        return result;\r\n    } catch (error) {\r\n        console.error('Arkesel SMS Error:', error);\r\n        return { success: false, error };\r\n    }\r\n};\r\n\r\nexport const getSMSBalance = async () => {\r\n    try {\r\n        // Updated to the correct V2 balance-details endpoint\r\n        const response = await fetch('https://sms.arkesel.com/api/v2/clients/balance-details', {\r\n            method: 'GET',\r\n            headers: {\r\n                'api-key': API_KEY,\r\n            },\r\n        });\r\n\r\n        if (!response.ok) {\r\n            console.error('Arkesel API Check Failed:', response.statusText);\r\n            return 0;\r\n        }\r\n\r\n        const result = await response.json();\r\n        console.log('Arkesel Balance Response:', result);\r\n\r\n        // V2 Response Structure: { status: \"success\", data: { sms_balance: \"2000\", ... } }\r\n        if (result.data) {\r\n            if (result.data.sms_balance !== undefined) return Number(result.data.sms_balance);\r\n            if (result.data.sms_unit !== undefined) return Number(result.data.sms_unit);\r\n            if (result.data.balance !== undefined) return Number(result.data.balance);\r\n        }\r\n\r\n        // V1 Fallback: { balance: 100, ... }\r\n        if (result.balance !== undefined) return Number(result.balance);\r\n\r\n        return 0;\r\n    } catch (error) {\r\n        console.error('Arkesel Balance Network Error:', error);\r\n        return 0;\r\n    }\r\n};\r\n"],"names":["API_KEY","sendSMS","recipients","message","settings","supabase","error","getSMSBalance","response","result"],"mappings":"sLAEA,MAAMA,EAAkD,8BAE3CC,EAAU,MAAOC,EAAsBC,IAAoB,CACpE,GAAI,CAEA,KAAM,CAAE,KAAMC,CAAA,EAAa,MAAMC,EAC5B,KAAK,kBAAkB,EACvB,OAAO,YAAY,EACnB,OAAA,EAEL,OAAID,GAAYA,EAAS,aAAe,IACpC,QAAQ,IAAI,2DAA2D,EAChE,CAAE,QAAS,GAAM,OAAQ,UAAW,QAAS,uBAAA,GAezC,MAZE,MAAM,MAAM,0CAA2C,CACpE,OAAQ,OACR,QAAS,CACL,UAAWJ,EACX,eAAgB,kBAAA,EAEpB,KAAM,KAAK,UAAU,CACjB,OAAQ,cACR,QAAAG,EACA,WAAAD,CAAA,CACH,CAAA,CACJ,GAC6B,KAAA,CAElC,OAASI,EAAO,CACZ,eAAQ,MAAM,qBAAsBA,CAAK,EAClC,CAAE,QAAS,GAAO,MAAAA,CAAA,CAC7B,CACJ,EAEaC,EAAgB,SAAY,CACrC,GAAI,CAEA,MAAMC,EAAW,MAAM,MAAM,yDAA0D,CACnF,OAAQ,MACR,QAAS,CACL,UAAWR,CAAA,CACf,CACH,EAED,GAAI,CAACQ,EAAS,GACV,eAAQ,MAAM,4BAA6BA,EAAS,UAAU,EACvD,EAGX,MAAMC,EAAS,MAAMD,EAAS,KAAA,EAI9B,GAHA,QAAQ,IAAI,4BAA6BC,CAAM,EAG3CA,EAAO,KAAM,CACb,GAAIA,EAAO,KAAK,cAAgB,cAAkB,OAAOA,EAAO,KAAK,WAAW,EAChF,GAAIA,EAAO,KAAK,WAAa,cAAkB,OAAOA,EAAO,KAAK,QAAQ,EAC1E,GAAIA,EAAO,KAAK,UAAY,cAAkB,OAAOA,EAAO,KAAK,OAAO,CAC5E,CAGA,OAAIA,EAAO,UAAY,OAAkB,OAAOA,EAAO,OAAO,EAEvD,CACX,OAASH,EAAO,CACZ,eAAQ,MAAM,iCAAkCA,CAAK,EAC9C,CACX,CACJ"}