import{j as e}from"./query-vendor-CC_3ftG1.js";import{u as E,r as l}from"./react-vendor-Bsfkyusf.js";import{u as O,s as o,N as q}from"./index-BpkOjQCb.js";import"./i18n-vendor-CQdsz7qV.js";import"./supabase-vendor-C3liu3n-.js";function L(){const{profile:c}=O(),h=E(),[b,k]=l.useState([]),[N,g]=l.useState(!0),[_,x]=l.useState(!1),[f,w]=l.useState(!1),[j,v]=l.useState(""),[n,p]=l.useState(["",""]),[m,y]=l.useState("");l.useEffect(()=>{if(c?.role!=="admin"&&c?.role!=="super_admin"){h("/marketplace");return}i()},[]);const i=async()=>{g(!0);try{const{data:t,error:s}=await o.from("polls").select(`
            *,
            options:poll_options(*)
        `).order("created_at",{ascending:!1});if(s)throw s;k(t||[])}catch(t){console.error("Error fetching polls:",t)}finally{g(!1)}},C=async t=>{if(t.preventDefault(),n.some(s=>!s.trim())){alert("Please fill in all options.");return}w(!0);try{const{data:s,error:a}=await o.from("polls").insert({question:j,created_by:c?.id,expires_at:m?new Date(m).toISOString():null,is_active:!0}).select().single();if(a)throw a;const r=n.map(u=>({poll_id:s.id,option_text:u})),{error:d}=await o.from("poll_options").insert(r);if(d)throw d;x(!1),v(""),p(["",""]),y(""),i()}catch(s){console.error("Error creating poll",s),alert(s.message)}finally{w(!1)}},S=async(t,s)=>{try{await o.from("polls").update({is_active:!s}).eq("id",t),i()}catch(a){console.error(a)}},P=async t=>{if(confirm("Delete this poll?"))try{await o.from("polls").delete().eq("id",t),i()}catch(s){console.error(s)}};return e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 transition-colors duration-300 pb-20 font-sans",children:[e.jsx(q,{}),e.jsxs("div",{className:"pt-32 md:pt-40 pb-12 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-6 mb-10",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:"px-3 py-1 rounded-full bg-cyan-100 dark:bg-cyan-900/30 text-cyan-700 dark:text-cyan-300 text-[10px] font-bold uppercase tracking-widest border border-cyan-200 dark:border-cyan-800",children:"Community Engagement"})}),e.jsx("h1",{className:"text-3xl md:text-5xl font-black text-slate-900 dark:text-white tracking-tight mb-2",children:"Polls"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 font-medium",children:"Gather feedback from the student body."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>h("/admin"),className:"px-6 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-200 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors text-xs font-bold uppercase tracking-wide whitespace-nowrap cursor-pointer flex items-center gap-2",children:[e.jsx("i",{className:"ri-arrow-left-line text-lg"}),"Dashboard"]}),e.jsxs("button",{onClick:()=>x(!0),className:"px-6 py-3 bg-cyan-600 text-white rounded-xl hover:bg-cyan-700 transition-colors text-xs font-bold uppercase tracking-wide whitespace-nowrap cursor-pointer flex items-center gap-2 shadow-lg shadow-cyan-200 dark:shadow-none",children:[e.jsx("i",{className:"ri-bar-chart-2-line text-lg"}),"Create Poll"]})]})]}),N?e.jsx("div",{className:"text-center py-20",children:e.jsx("i",{className:"ri-loader-4-line text-4xl animate-spin text-cyan-600"})}):b.length===0?e.jsxs("div",{className:"text-center py-20 bg-white dark:bg-slate-800 rounded-[2rem]",children:[e.jsx("div",{className:"w-20 h-20 bg-slate-50 dark:bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx("i",{className:"ri-question-answer-line text-4xl text-slate-300"})}),e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white",children:"No polls created"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Create a poll to start gathering opinions."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:b.map(t=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-3xl border border-slate-100 dark:border-slate-700 shadow-sm relative group hover:shadow-lg transition-all",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:`px-2 py-1 rounded text-[10px] font-bold uppercase tracking-widest ${t.is_active?"bg-emerald-100 text-emerald-700":"bg-slate-100 text-slate-500"}`,children:t.is_active?"Active":"Closed"}),e.jsxs("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>S(t.id,t.is_active),className:"w-8 h-8 rounded-full bg-slate-100 hover:bg-slate-200 flex items-center justify-center text-slate-600",children:e.jsx("i",{className:`ri-${t.is_active?"stop":"play"}-line`})}),e.jsx("button",{onClick:()=>P(t.id),className:"w-8 h-8 rounded-full bg-rose-100 hover:bg-rose-200 flex items-center justify-center text-rose-600",children:e.jsx("i",{className:"ri-delete-bin-line"})})]})]}),e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white mb-6 min-h-[3.5rem]",children:t.question}),e.jsx("div",{className:"space-y-3",children:t.options.map(s=>{const a=t.options.reduce((d,u)=>d+(u.votes_count||0),0),r=a>0?Math.round(s.votes_count/a*100):0;return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex justify-between text-xs font-bold text-slate-600 dark:text-slate-300 mb-1 z-10 relative",children:[e.jsx("span",{children:s.option_text}),e.jsxs("span",{children:[r,"%"]})]}),e.jsx("div",{className:"h-2 w-full bg-slate-100 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-cyan-500 rounded-full",style:{width:`${r}%`}})})]},s.id)})}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-slate-50 dark:border-slate-700 text-xs text-slate-400 font-bold uppercase tracking-wider text-right",children:[t.options.reduce((s,a)=>s+(a.votes_count||0),0)," Total Votes"]})]},t.id))})]}),_&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-in fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-3xl shadow-2xl max-w-lg w-full p-8 border border-slate-100 dark:border-slate-800",children:[e.jsx("h3",{className:"text-2xl font-black text-slate-900 dark:text-white mb-6",children:"Create New Poll"}),e.jsxs("form",{onSubmit:C,children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-xs font-bold uppercase tracking-wide text-slate-500 mb-2",children:"Question"}),e.jsx("input",{type:"text",value:j,onChange:t=>v(t.target.value),required:!0,className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 border-none rounded-xl focus:ring-2 focus:ring-cyan-500/50 outline-none font-bold text-slate-900 dark:text-white",placeholder:"e.g. What framework should we learn next?"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-xs font-bold uppercase tracking-wide text-slate-500 mb-2",children:"Options"}),e.jsx("div",{className:"space-y-3",children:n.map((t,s)=>e.jsx("input",{type:"text",value:t,onChange:a=>{const r=[...n];r[s]=a.target.value,p(r)},className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 border-none rounded-xl outline-none text-sm text-slate-700 dark:text-slate-300 placeholder:text-slate-400",placeholder:`Option ${s+1}`},s))}),e.jsx("button",{type:"button",onClick:()=>p([...n,""]),className:"mt-3 text-xs font-bold text-cyan-600 uppercase tracking-wide hover:underline",children:"+ Add Option"})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("label",{className:"block text-xs font-bold uppercase tracking-wide text-slate-500 mb-2",children:"Expires At (Optional)"}),e.jsx("input",{type:"datetime-local",value:m,onChange:t=>y(t.target.value),className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 border-none rounded-xl outline-none font-bold text-slate-900 dark:text-white"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:()=>x(!1),className:"flex-1 py-3 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 font-bold rounded-xl uppercase tracking-widest text-xs hover:bg-slate-200",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:f,className:"flex-1 py-3 bg-cyan-600 text-white font-bold rounded-xl uppercase tracking-widest text-xs hover:bg-cyan-700 shadow-lg shadow-cyan-200 dark:shadow-none flex items-center justify-center gap-2",children:[f&&e.jsx("i",{className:"ri-loader-4-line animate-spin"}),"Launch Poll"]})]})]})]})})]})}export{L as default};
//# sourceMappingURL=PollManagement-CcOVaqMC.js.map
