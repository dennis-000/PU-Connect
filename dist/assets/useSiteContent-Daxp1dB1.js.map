{"version":3,"file":"useSiteContent-Daxp1dB1.js","sources":["../../src/hooks/useSiteContent.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { supabase } from '../lib/supabase';\r\n\r\nexport const CONTENT_KEYS = {\r\n    HOME_HERO_MAIN: 'home_hero_main',\r\n    HOME_HERO_AERIAL: 'home_hero_aerial',\r\n    MARKETPLACE_BANNER: 'marketplace_banner',\r\n    NEWS_BANNER: 'news_banner',\r\n};\r\n\r\nconst DEFAULTS = {\r\n    [CONTENT_KEYS.HOME_HERO_MAIN]: '/Pentecost-University-Sowutoum-Ghana-SchoolFinder-TortoisePathcom-2-1536x1152.jpeg',\r\n    [CONTENT_KEYS.HOME_HERO_AERIAL]: '/Pentecost-University-Sowutoum-Ghana-SchoolFinder-TortoisePathcom-11.jpeg',\r\n    [CONTENT_KEYS.MARKETPLACE_BANNER]: '/Pentecost-University-Sowutoum-Ghana-SchoolFinder-TortoisePathcom-11.jpeg',\r\n    [CONTENT_KEYS.NEWS_BANNER]: '/Pentecost-University-Sowutoum-Ghana-SchoolFinder-TortoisePathcom-2-1536x1152.jpeg',\r\n};\r\n\r\nexport function useSiteContent(key: string) {\r\n    const [url, setUrl] = useState<string>(DEFAULTS[key] || '');\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        let mounted = true;\r\n\r\n        async function checkContent() {\r\n            try {\r\n                // 1. Check persistent cache\r\n                const cached = localStorage.getItem(`site_content_${key}`);\r\n                if (cached && mounted) {\r\n                    setUrl(cached);\r\n                }\r\n\r\n                // 2. Silently check for config file existence to avoid noisy 400 errors\r\n                const { data: files } = await supabase.storage\r\n                    .from('uploads')\r\n                    .list('', { limit: 1, search: 'site_config.json' });\r\n\r\n                if (!files || files.length === 0) {\r\n                    if (mounted) setLoading(false);\r\n                    return;\r\n                }\r\n\r\n                // 3. Download and parse\r\n                const { data: blob, error: downloadError } = await supabase.storage\r\n                    .from('uploads')\r\n                    .download('site_config.json');\r\n\r\n                if (downloadError) throw downloadError;\r\n\r\n                if (blob && mounted) {\r\n                    const text = await blob.text();\r\n                    const config = JSON.parse(text);\r\n                    const remoteUrl = config[key];\r\n\r\n                    if (remoteUrl && remoteUrl !== cached) {\r\n                        setUrl(remoteUrl);\r\n                        localStorage.setItem(`site_content_${key}`, remoteUrl);\r\n                    }\r\n                }\r\n            } catch (err) {\r\n                // Completely silent for site content - defaults are fine\r\n            } finally {\r\n                if (mounted) setLoading(false);\r\n            }\r\n        }\r\n\r\n        checkContent();\r\n        return () => { mounted = false; };\r\n    }, [key]);\r\n\r\n    return { url, loading };\r\n}\r\n"],"names":["CONTENT_KEYS","DEFAULTS","useSiteContent","key","url","setUrl","useState","loading","setLoading","useEffect","mounted","checkContent","cached","files","supabase","blob","downloadError","text","remoteUrl"],"mappings":"kFAGO,MAAMA,EAAe,CACxB,eAAgB,iBAChB,iBAAkB,mBAClB,mBAAoB,qBACpB,YAAa,aACjB,EAEMC,EAAW,CACb,CAACD,EAAa,cAAc,EAAG,qFAC/B,CAACA,EAAa,gBAAgB,EAAG,4EACjC,CAACA,EAAa,kBAAkB,EAAG,4EACnC,CAACA,EAAa,WAAW,EAAG,oFAChC,EAEO,SAASE,EAAeC,EAAa,CACxC,KAAM,CAACC,EAAKC,CAAM,EAAIC,EAAAA,SAAiBL,EAASE,CAAG,GAAK,EAAE,EACpD,CAACI,EAASC,CAAU,EAAIF,EAAAA,SAAS,EAAI,EAE3CG,OAAAA,EAAAA,UAAU,IAAM,CACZ,IAAIC,EAAU,GAEd,eAAeC,GAAe,CAC1B,GAAI,CAEA,MAAMC,EAAS,aAAa,QAAQ,gBAAgBT,CAAG,EAAE,EACrDS,GAAUF,GACVL,EAAOO,CAAM,EAIjB,KAAM,CAAE,KAAMC,CAAA,EAAU,MAAMC,EAAS,QAClC,KAAK,SAAS,EACd,KAAK,GAAI,CAAE,MAAO,EAAG,OAAQ,mBAAoB,EAEtD,GAAI,CAACD,GAASA,EAAM,SAAW,EAAG,CAC1BH,KAAoB,EAAK,EAC7B,MACJ,CAGA,KAAM,CAAE,KAAMK,EAAM,MAAOC,CAAA,EAAkB,MAAMF,EAAS,QACvD,KAAK,SAAS,EACd,SAAS,kBAAkB,EAEhC,GAAIE,EAAe,MAAMA,EAEzB,GAAID,GAAQL,EAAS,CACjB,MAAMO,EAAO,MAAMF,EAAK,KAAA,EAElBG,EADS,KAAK,MAAMD,CAAI,EACLd,CAAG,EAExBe,GAAaA,IAAcN,IAC3BP,EAAOa,CAAS,EAChB,aAAa,QAAQ,gBAAgBf,CAAG,GAAIe,CAAS,EAE7D,CACJ,MAAc,CAEd,QAAA,CACQR,KAAoB,EAAK,CACjC,CACJ,CAEA,OAAAC,EAAA,EACO,IAAM,CAAED,EAAU,EAAO,CACpC,EAAG,CAACP,CAAG,CAAC,EAED,CAAE,IAAAC,EAAK,QAAAG,CAAA,CAClB"}